/*
 Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
  Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
 Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
  (https://github.com/101arrowz/fflate) for use in Troika text rendering. 
  Original licenses apply: 
  - fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
  - woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
 Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
  for use in Troika text rendering. 
  Original MIT license applies
*/
'use strict';(function(I,E){"object"===typeof exports&&"undefined"!==typeof module?E(exports,require("three"),require("troika-worker-utils"),require("webgl-sdf-generator"),require("bidi-js"),require("troika-three-utils")):"function"===typeof define&&define.amd?define("exports three troika-worker-utils webgl-sdf-generator bidi-js troika-three-utils".split(" "),E):(I="undefined"!==typeof globalThis?globalThis:I||self,E(I.troika_three_text={},I.THREE,I.troika_worker_utils,I.webgl_sdf_generator,I.bidi_js,
I.troika_three_utils))})(this,function(I,E,ba,R,Y,pa){function ya(d){return d&&"object"===typeof d&&"default"in d?d:{"default":d}}function Ua(d,f,k,l,b,a,c,e,h,g,n=!0){return n?Va(d,f,k,l,b,a,c,e,h,g).then(null,n=>{za||(console.warn("WebGL SDF generation failed, falling back to JS",n),za=!0);return Aa(d,f,k,l,b,a,c,e,h,g)}):Aa(d,f,k,l,b,a,c,e,h,g)}function Ba(){let d=S();for(;ja.length&&5>S()-d;)ja.shift()();qa=ja.length?setTimeout(Ba,0):0}function Aa(d,f,k,l,b,a,c,e,h,g){let n="TroikaTextSDFGenerator_JS_"+
Wa++%4,m=Ca[n];m||(m=Ca[n]={workerModule:ba.defineWorkerModule({name:n,workerId:n,dependencies:[Da["default"],S],init(a,b){let c=a().javascript.generate;return function(...a){let e=b();return{textureData:c(...a),timing:b()-e}}},getTransferables(a){return[a.textureData.buffer]}}),requests:0,idleTimer:null});m.requests++;clearTimeout(m.idleTimer);return m.workerModule(d,f,k,l,b,a).then(({textureData:a,timing:b})=>{let p=S(),k=new Uint8Array(4*a.length);for(let b=0;b<a.length;b++)k[4*b+g]=a[b];ka.webglUtils.renderImageData(c,
k,e,h,d,f,1<<3-g);b+=S()-p;0===--m.requests&&(m.idleTimer=setTimeout(()=>{ba.terminateWorker(n)},2E3));return{timing:b}})}function Z(){return(self.performance||Date).now()}function ra(d,f){Ea=!0;d=Fa({},d);let k=Z();var {defaultFontURL:l}=T,b=[];l&&b.push({label:"default",src:Ga(l)});d.font&&b.push({label:"user",src:Ga(d.font)});d.font=b;d.text=""+d.text;d.sdfGlyphSize=d.sdfGlyphSize||T.sdfGlyphSize;d.unicodeFontsURL=d.unicodeFontsURL||T.unicodeFontsURL;if(null!=d.colorRanges){l={};for(var a in d.colorRanges)d.colorRanges.hasOwnProperty(a)&&
(b=d.colorRanges[a],"number"!==typeof b&&(b=Xa.set(b).getHex()),l[a]=b);d.colorRanges=l}Object.freeze(d);let {textureWidth:c,sdfExponent:e}=T,{sdfGlyphSize:h}=d,g=c/h*4,n=la[h];n||(a=document.createElement("canvas"),a.width=c,a.height=256*h/g,n=la[h]={glyphCount:0,sdfGlyphSize:h,sdfCanvas:a,sdfTexture:new E.Texture(a,void 0,void 0,void 0,E.LinearFilter,E.LinearFilter),contextLost:!1,glyphsByFont:new Map},n.sdfTexture.generateMipmaps=!1,Ya(n));let {sdfTexture:m,sdfCanvas:p}=n;Za(d).then(a=>{let {glyphIds:b,
glyphFontIndices:l,fontData:y,glyphPositions:t,fontSize:v,timings:w}=a,u=[],G=new Float32Array(4*b.length),J=0,C=0;var z=Z();let H=y.map(a=>{let b=n.glyphsByFont.get(a.src);b||n.glyphsByFont.set(a.src,b=new Map);return b});b.forEach((c,e)=>{var f=l[e];let {src:g,unitsPerEm:d}=y[f];var m=H[f].get(c);if(!m){let {path:b,pathBounds:e}=a.glyphData[g][c];m=Math.max(e[2]-e[0],e[3]-e[1])/h*(T.sdfMargin*h+.5);var p=n.glyphCount++;H[f].set(c,m={path:b,atlasIndex:p,sdfViewBox:[e[0]-m,e[1]-m,e[2]+m,e[3]+m]});
u.push(m)}({sdfViewBox:c}=m);f=t[C++];p=t[C++];let k=v/d;G[J++]=f+c[0]*k;G[J++]=p+c[1]*k;G[J++]=f+c[2]*k;G[J++]=p+c[3]*k;b[e]=m.atlasIndex});w.quads=(w.quads||0)+(Z()-z);let B=Z();w.sdf={};z=p.height;let L=Math.pow(2,Math.ceil(Math.log2(Math.ceil(n.glyphCount/g)*h)));L>z&&(console.info(`Increasing SDF texture size ${z}->${L}`),$a(p,c,L),m.dispose());Promise.all(u.map(a=>Ha(a,n,d.gpuAccelerateSDF).then(({timing:b})=>{w.sdf[a.atlasIndex]=b}))).then(()=>{u.length&&!n.contextLost&&(Ia(n),m.needsUpdate=
!0);w.sdfTotal=Z()-B;w.total=Z()-k;f(Object.freeze({parameters:d,sdfTexture:m,sdfGlyphSize:h,sdfExponent:e,glyphBounds:G,glyphAtlasIndices:b,glyphColors:a.glyphColors,caretPositions:a.caretPositions,chunkedBounds:a.chunkedBounds,ascender:a.ascender,descender:a.descender,lineHeight:a.lineHeight,capHeight:a.capHeight,xHeight:a.xHeight,topBaseline:a.topBaseline,blockBounds:a.blockBounds,visibleBounds:a.visibleBounds,timings:a.timings}))})});Promise.resolve().then(()=>{n.contextLost||p._warm||(ka.webgl.isSupported(p),
p._warm=!0)})}function Ha({path:d,atlasIndex:f,sdfViewBox:k},{sdfGlyphSize:l,sdfCanvas:b,contextLost:a},c){if(a)return Promise.resolve({timing:-1});let {textureWidth:e,sdfExponent:h}=T;a=Math.floor(f/4);return Ua(l,l,d,k,Math.max(k[2]-k[0],k[3]-k[1]),h,b,a%(e/l)*l,Math.floor(a/(e/l))*l,f%4,c)}function Ya(d){let f=d.sdfCanvas;f.addEventListener("webglcontextlost",f=>{console.log("Context Lost",f);f.preventDefault();d.contextLost=!0});f.addEventListener("webglcontextrestored",f=>{console.log("Context Restored",
f);d.contextLost=!1;let k=[];d.glyphsByFont.forEach(b=>{b.forEach(a=>{k.push(Ha(a,d,!0))})});Promise.all(k).then(()=>{Ia(d);d.sdfTexture.needsUpdate=!0})})}function Fa(d,f){for(let k in f)f.hasOwnProperty(k)&&(d[k]=f[k]);return d}function Ga(d){ma||(ma="undefined"===typeof document?{}:document.createElement("a"));ma.href=d;return ma.href}function Ia(d){if("function"!==typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let {sdfCanvas:f,sdfTexture:k}=d,{width:l,height:b}=
f;d=d.sdfCanvas.getContext("webgl");let a=k.image.data;a&&a.length===l*b*4||(a=new Uint8Array(l*b*4),k.image={width:l,height:b,data:a},k.flipY=!1,k.isDataTexture=!0);d.readPixels(0,0,l,b,d.RGBA,d.UNSIGNED_BYTE,a)}}function ab(d){let f=Ja[d];f||(f=Ja[d]=(new E.PlaneGeometry(1,1,d,d)).translate(.5,.5,0));return f}function sa(d){d=pa.createDerivedMaterial(d,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new E.Vector2},uTroikaSDFGlyphSize:{value:0},
uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new E.Vector4(0,0,0,0)},uTroikaClipRect:{value:new E.Vector4(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new E.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new E.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new E.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},
vertexDefs:"\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform vec4 uTroikaTotalBounds;\nuniform vec4 uTroikaClipRect;\nuniform mat3 uTroikaOrient;\nuniform bool uTroikaUseGlyphColors;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaBlurRadius;\nuniform vec2 uTroikaPositionOffset;\nuniform float uTroikaCurveRadius;\nattribute vec4 aTroikaGlyphBounds;\nattribute float aTroikaGlyphIndex;\nattribute vec3 aTroikaGlyphColor;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec3 vTroikaGlyphColor;\nvarying vec2 vTroikaGlyphDimensions;\n",
vertexTransform:"\nvec4 bounds = aTroikaGlyphBounds;\nbounds.xz += uTroikaPositionOffset.x;\nbounds.yw -= uTroikaPositionOffset.y;\n\nvec4 outlineBounds = vec4(\n  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,\n  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius\n);\nvec4 clippedBounds = vec4(\n  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),\n  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)\n);\n\nvec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);\n\nposition.xy = mix(bounds.xy, bounds.zw, clippedXY);\n\nuv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);\n\nfloat rad = uTroikaCurveRadius;\nif (rad != 0.0) {\n  float angle = position.x / rad;\n  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);\n  normal.xz = vec2(sin(angle), cos(angle));\n}\n  \nposition = uTroikaOrient * position;\nnormal = uTroikaOrient * normal;\n\nvTroikaGlyphUV = clippedXY.xy;\nvTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);\n\n\nfloat txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;\nvec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;\nvec2 txStartUV = txUvPerSquare * vec2(\n  mod(floor(aTroikaGlyphIndex / 4.0), txCols),\n  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)\n);\nvTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);\nvTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);\n",
fragmentDefs:"\nuniform sampler2D uTroikaSDFTexture;\nuniform vec2 uTroikaSDFTextureSize;\nuniform float uTroikaSDFGlyphSize;\nuniform float uTroikaSDFExponent;\nuniform float uTroikaDistanceOffset;\nuniform float uTroikaFillOpacity;\nuniform float uTroikaOutlineOpacity;\nuniform float uTroikaBlurRadius;\nuniform vec3 uTroikaStrokeColor;\nuniform float uTroikaStrokeWidth;\nuniform float uTroikaStrokeOpacity;\nuniform bool uTroikaSDFDebug;\nvarying vec2 vTroikaGlyphUV;\nvarying vec4 vTroikaTextureUVBounds;\nvarying float vTroikaTextureChannel;\nvarying vec2 vTroikaGlyphDimensions;\n\nfloat troikaSdfValueToSignedDistance(float alpha) {\n  // Inverse of exponential encoding in webgl-sdf-generator\n  \n  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);\n  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;\n  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);\n  return signedDist;\n}\n\nfloat troikaGlyphUvToSdfValue(vec2 glyphUV) {\n  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);\n  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);\n  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1\n  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;\n}\n\nfloat troikaGlyphUvToDistance(vec2 uv) {\n  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));\n}\n\nfloat troikaGetAADist() {\n  \n  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\n  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;\n  #else\n  return vTroikaGlyphDimensions.x / 64.0;\n  #endif\n}\n\nfloat troikaGetFragDistValue() {\n  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);\n  float distance = troikaGlyphUvToDistance(clampedGlyphUV);\n \n  // Extrapolate distance when outside bounds:\n  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : \n    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);\n\n  \n\n  return distance;\n}\n\nfloat troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {\n  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)\n  float alpha = step(-distanceOffset, -distance);\n  #else\n\n  float alpha = smoothstep(\n    distanceOffset + aaDist,\n    distanceOffset - aaDist,\n    distance\n  );\n  #endif\n\n  return alpha;\n}\n",
fragmentColorTransform:"\nfloat aaDist = troikaGetAADist();\nfloat fragDistance = troikaGetFragDistValue();\nfloat edgeAlpha = uTroikaSDFDebug ?\n  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :\n  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));\n\n#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)\nvec4 fillRGBA = gl_FragColor;\nfillRGBA.a *= uTroikaFillOpacity;\nvec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);\nif (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;\ngl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(\n  -uTroikaStrokeWidth - aaDist,\n  -uTroikaStrokeWidth + aaDist,\n  fragDistance\n));\ngl_FragColor.a *= edgeAlpha;\n#endif\n\nif (edgeAlpha == 0.0) {\n  discard;\n}\n",
customRewriter({vertexShader:f,fragmentShader:d}){let k=/\buniform\s+vec3\s+diffuse\b/;k.test(d)&&(d=d.replace(k,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),k.test(f)||(f=f.replace(pa.voidMainRegExp,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n")));return{vertexShader:f,fragmentShader:d}}});d.transparent=!0;d.forceSinglePass=!0;Object.defineProperties(d,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},
set(){}}});return d}function Ka(d){return Array.isArray(d)?d[0]:d}function ta(d,f){let k=new d.constructor(f);k.set(d.subarray(0,f));return k}function bb(d){let f=pa.createDerivedMaterial(d,{chained:!0,uniforms:{uTroikaMatricesTextureSize:{value:new E.Vector2},uTroikaMatricesTexture:{value:null}},vertexDefs:"\n      uniform sampler2D uTroikaMatricesTexture;\n      uniform vec2 uTroikaMatricesTextureSize;\n      attribute float aTroikaTextInstanceIndex;\n      varying vec3 vTroikaTextColor;\n\n      vec4 troikaGetTexel(float i) {\n        float w = uTroikaMatricesTextureSize.x;\n        vec2 uv = (vec2(mod(i, w), floor(i / w)) + 0.5) / w;\n        return texture2D(uTroikaMatricesTexture, uv);\n      }\n      vec3 troikaFloatToColor(float v) {\n        return mod(floor(vec3(v / 65536.0, v / 256.0, v)), 256.0) / 256.0;\n      }\n    ",
vertexTransform:`
      float i = ${"aTroikaTextInstanceIndex"} * ${ha.toFixed(1)} / 4.0;
      mat4 matrix = mat4(
        troikaGetTexel(i),
        troikaGetTexel(i + 1.0),
        troikaGetTexel(i + 2.0),
        troikaGetTexel(i + 3.0)
      );
      position.xyz = (matrix * vec4(position, 1.0)).xyz;

      float packedColor = troikaGetTexel(i + 4.0).r;
      ${"vTroikaTextColor"} = troikaFloatToColor(packedColor);
    `,fragmentDefs:"\n      varying vec3 vTroikaTextColor;\n    ",fragmentColorTransform:"\n      gl_FragColor.rgb = vTroikaTextColor;\n    "});f.setMatrixTexture=d=>{f.uniforms.uTroikaMatricesTexture.value=d;f.uniforms.uTroikaMatricesTextureSize.value.set(d.image.width,d.image.height)};return sa(f)}function cb(d){let f=La.get(d);if(!f){f=[];let {caretPositions:k}=d,l,b=(a,b,h,g)=>{(!l||h<(l.top+l.bottom)/2)&&f.push(l={bottom:b,top:h,carets:[]});h>l.top&&(l.top=h);b<l.bottom&&(l.bottom=b);l.carets.push({x:a,
y:b,height:h-b,charIndex:g})},a=0;for(;a<k.length;a+=4)b(k[a],k[a+2],k[a+3],a/4);b(k[a-3],k[a-2],k[a-1],a/4)}La.set(d,f);return f}var Da=ya(R);Y=ya(Y);R=ba.defineWorkerModule({name:"Typr Font Parser",dependencies:[function(){return"undefined"==typeof window&&(self.window=self),function(d){var f={parse:function(b){var a=f._bin;b=new Uint8Array(b);if("ttcf"==a.readASCII(b,0,4)){var c=4;a.readUshort(b,c);c+=2;a.readUshort(b,c);c+=2;var e=a.readUint(b,c);c+=4;for(var h=[],g=0;g<e;g++){var n=a.readUint(b,
c);c+=4;h.push(f._readFont(b,n))}return h}return[f._readFont(b,0)]},_readFont:function(b,a){var c=f._bin,e=a;c.readFixed(b,a);a+=4;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var g="cmap;head;hhea;maxp;hmtx;name;OS/2;post;loca;glyf;kern;CFF ;GDEF;GPOS;GSUB;SVG ".split(";");e={_data:b,_offset:e};for(var n={},d=0;d<h;d++){var p=c.readASCII(b,a,4);a+=4;c.readUint(b,a);a+=4;var k=c.readUint(b,a);a+=4;var l=c.readUint(b,a);a+=4;n[p]={offset:k,length:l}}for(d=
0;d<g.length;d++)a=g[d],n[a]&&(e[a.trim()]=f[a.trim()].parse(b,n[a].offset,n[a].length,e));return e},_tabOffset:function(b,a,c){var e=f._bin,h=e.readUshort(b,c+4);c+=12;for(var g=0;g<h;g++){var n=e.readASCII(b,c,4);c+=4;e.readUint(b,c);c+=4;var d=e.readUint(b,c);if(c+=4,e.readUint(b,c),c+=4,n==a)return d}return 0}};f._bin={readFixed:function(b,a){return(b[a]<<8|b[a+1])+(b[a+2]<<8|b[a+3])/65540},readF2dot14:function(b,a){return f._bin.readShort(b,a)/16384},readInt:function(b,a){return f._bin._view(b).getInt32(a)},
readInt8:function(b,a){return f._bin._view(b).getInt8(a)},readShort:function(b,a){return f._bin._view(b).getInt16(a)},readUshort:function(b,a){return f._bin._view(b).getUint16(a)},readUshorts:function(b,a,c){for(var e=[],h=0;h<c;h++)e.push(f._bin.readUshort(b,a+2*h));return e},readUint:function(b,a){return f._bin._view(b).getUint32(a)},readUint64:function(b,a){return 4294967296*f._bin.readUint(b,a)+f._bin.readUint(b,a+4)},readASCII:function(b,a,c){for(var e="",f=0;f<c;f++)e+=String.fromCharCode(b[a+
f]);return e},readUnicode:function(b,a,c){for(var e="",f=0;f<c;f++){var g=b[a++]<<8|b[a++];e+=String.fromCharCode(g)}return e},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(b,a,c){var e=f._bin._tdec;return e&&0==a&&c==b.length?e.decode(b):f._bin.readASCII(b,a,c)},readBytes:function(b,a,c){for(var e=[],f=0;f<c;f++)e.push(b[a+f]);return e},readASCIIArray:function(b,a,c){for(var e=[],f=0;f<c;f++)e.push(String.fromCharCode(b[a+f]));return e},_view:function(b){return b._dataView||
(b._dataView=b.buffer?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView((new Uint8Array(b)).buffer))}};f._lctf={};f._lctf.parse=function(b,a,c,e,h){var g=f._bin;c={};e=a;g.readFixed(b,a);a+=4;var n=g.readUshort(b,a);a+=2;var d=g.readUshort(b,a);a=g.readUshort(b,a+2);return c.scriptList=f._lctf.readScriptList(b,e+n),c.featureList=f._lctf.readFeatureList(b,e+d),c.lookupList=f._lctf.readLookupList(b,e+a,h),c};f._lctf.readLookupList=function(b,a,c){var e=f._bin,h=a,g=[],n=e.readUshort(b,a);
a+=2;for(var d=0;d<n;d++){var p=e.readUshort(b,a);a+=2;p=f._lctf.readLookupTable(b,h+p,c);g.push(p)}return g};f._lctf.readLookupTable=function(b,a,c){var e=f._bin,h=a,g={tabs:[]};g.ltype=e.readUshort(b,a);a+=2;g.flag=e.readUshort(b,a);a+=2;var n=e.readUshort(b,a);a+=2;for(var d=g.ltype,p=0;p<n;p++){var k=e.readUshort(b,a);a+=2;k=c(b,d,h+k,g);g.tabs.push(k)}return g};f._lctf.numOfOnes=function(b){for(var a=0,c=0;32>c;c++)0!=(b>>>c&1)&&a++;return a};f._lctf.readClassDef=function(b,a){var c=f._bin,e=
[],h=c.readUshort(b,a);if(a+=2,1==h){var g=c.readUshort(b,a);a+=2;var n=c.readUshort(b,a);a+=2;for(var d=0;d<n;d++)e.push(g+d),e.push(g+d),e.push(c.readUshort(b,a)),a+=2}if(2==h)for(h=c.readUshort(b,a),a+=2,d=0;d<h;d++)e.push(c.readUshort(b,a)),a+=2,e.push(c.readUshort(b,a)),a+=2,e.push(c.readUshort(b,a)),a+=2;return e};f._lctf.getInterval=function(b,a){for(var c=0;c<b.length;c+=3){var e=b[c],f=b[c+1];if(b[c+2],e<=a&&a<=f)return c}return-1};f._lctf.readCoverage=function(b,a){var c=f._bin,e={};e.fmt=
c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);return a+=2,1==e.fmt&&(e.tab=c.readUshorts(b,a,h)),2==e.fmt&&(e.tab=c.readUshorts(b,a,3*h)),e};f._lctf.coverageIndex=function(b,a){var c=b.tab;return 1==b.fmt?c.indexOf(a):2==b.fmt&&(b=f._lctf.getInterval(c,a),-1!=b)?c[b+2]+(a-c[b]):-1};f._lctf.readFeatureList=function(b,a){var c=f._bin,e=a,h=[],g=c.readUshort(b,a);a+=2;for(var n=0;n<g;n++){var d=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;p=f._lctf.readFeatureTable(b,e+p);p.tag=d.trim();h.push(p)}return h};
f._lctf.readFeatureTable=function(b,a){var c=f._bin,e=a,h={},g=c.readUshort(b,a);a+=2;0<g&&(h.featureParams=e+g);e=c.readUshort(b,a);a+=2;h.tab=[];for(g=0;g<e;g++)h.tab.push(c.readUshort(b,a+2*g));return h};f._lctf.readScriptList=function(b,a){var c=f._bin,e=a,h={},g=c.readUshort(b,a);a+=2;for(var n=0;n<g;n++){var d=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;h[d.trim()]=f._lctf.readScriptTable(b,e+p)}return h};f._lctf.readScriptTable=function(b,a){var c=f._bin,e=a,h={},g=c.readUshort(b,
a);a+=2;0<g&&(h.default=f._lctf.readLangSysTable(b,e+g));g=c.readUshort(b,a);a+=2;for(var n=0;n<g;n++){var d=c.readASCII(b,a,4);a+=4;var p=c.readUshort(b,a);a+=2;h[d.trim()]=f._lctf.readLangSysTable(b,e+p)}return h};f._lctf.readLangSysTable=function(b,a){var c=f._bin,e={};c.readUshort(b,a);a+=2;e.reqFeature=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);return a+=2,e.features=c.readUshorts(b,a,h),e};f.CFF={};f.CFF.parse=function(b,a,c){var e=f._bin;(b=new Uint8Array(b.buffer,a,c))[a=0];b[++a];b[++a];
b[++a];a++;var h=[];a=f.CFF.readIndex(b,a,h);var g=[];for(c=0;c<h.length-1;c++)g.push(e.readASCII(b,a+h[c],h[c+1]-h[c]));a+=h[h.length-1];h=[];a=f.CFF.readIndex(b,a,h);g=[];for(c=0;c<h.length-1;c++)g.push(f.CFF.readDict(b,a+h[c],a+h[c+1]));a+=h[h.length-1];h=g[0];var n=[];a=f.CFF.readIndex(b,a,n);g=[];for(c=0;c<n.length-1;c++)g.push(e.readASCII(b,a+n[c],n[c+1]-n[c]));if(a+=n[n.length-1],f.CFF.readSubrs(b,a,h),h.CharStrings){a=h.CharStrings;n=[];a=f.CFF.readIndex(b,a,n);var d=[];for(c=0;c<n.length-
1;c++)d.push(e.readBytes(b,a+n[c],n[c+1]-n[c]));h.CharStrings=d}if(h.ROS){a=h.FDArray;n=[];a=f.CFF.readIndex(b,a,n);h.FDArray=[];for(c=0;c<n.length-1;c++)d=f.CFF.readDict(b,a+n[c],a+n[c+1]),f.CFF._readFDict(b,d,g),h.FDArray.push(d);a=h.FDSelect;h.FDSelect=[];c=b[a];if(a++,3!=c)throw c;n=e.readUshort(b,a);a+=2;for(c=0;c<n+1;c++)h.FDSelect.push(e.readUshort(b,a),b[a+2]),a+=3}return h.Encoding&&(h.Encoding=f.CFF.readEncoding(b,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=f.CFF.readCharset(b,
h.charset,h.CharStrings.length)),f.CFF._readFDict(b,h,g),h};f.CFF._readFDict=function(b,a,c){var e,h;for(h in a.Private&&(e=a.Private[1],a.Private=f.CFF.readDict(b,e,e+a.Private[0]),a.Private.Subrs&&f.CFF.readSubrs(b,e+a.Private.Subrs,a.Private)),a)-1!="FamilyName FontName FullName Notice version Copyright".split(" ").indexOf(h)&&(a[h]=c[a[h]-426+35])};f.CFF.readSubrs=function(b,a,c){var e=f._bin,h=[];a=f.CFF.readIndex(b,a,h);var g=h.length;c.Bias=1240>g?107:33900>g?1131:32768;c.Subrs=[];for(g=0;g<
h.length-1;g++)c.Subrs.push(e.readBytes(b,a+h[g],h[g+1]-h[g]))};f.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,
101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0];f.CFF.glyphByUnicode=function(b,a){for(var c=0;c<b.charset.length;c++)if(b.charset[c]==a)return c;return-1};f.CFF.glyphBySE=function(b,a){return 0>a||255<a?-1:f.CFF.glyphByUnicode(b,f.CFF.tableSE[a])};f.CFF.readEncoding=function(b,
a,c){f._bin;c=[".notdef"];var e=b[a];if(a++,0!=e)throw"error: unknown encoding format: "+e;e=b[a];a++;for(var h=0;h<e;h++)c.push(b[a+h]);return c};f.CFF.readCharset=function(b,a,c){var e=f._bin,h=[".notdef"],g=b[a];if(a++,0==g)for(var n=0;n<c;n++){var d=e.readUshort(b,a);a+=2;h.push(d)}else{if(1!=g&&2!=g)throw"error: format: "+g;for(;h.length<c;){d=e.readUshort(b,a);a+=2;var p=0;1==g?(p=b[a],a++):(p=e.readUshort(b,a),a+=2);for(n=0;n<=p;n++)h.push(d),d++}}return h};f.CFF.readIndex=function(b,a,c){var e=
f._bin,h=e.readUshort(b,a)+1,g=b[a+=2];if(a++,1==g)for(var n=0;n<h;n++)c.push(b[a+n]);else if(2==g)for(n=0;n<h;n++)c.push(e.readUshort(b,a+2*n));else if(3==g)for(n=0;n<h;n++)c.push(16777215&e.readUint(b,a+3*n-1));else if(1!=h)throw"unsupported offset size: "+g+", count: "+h;return a+h*g-1};f.CFF.getCharString=function(b,a,c){var e=f._bin,h=b[a],g=b[a+1];b[a+2];b[a+3];b[a+4];var n=1,d=null,p=null;20>=h&&(d=h,n=1);12==h&&(d=100*h+g,n=2);21<=h&&27>=h&&(d=h,n=1);28==h&&(p=e.readShort(b,a+1),n=3);29<=
h&&31>=h&&(d=h,n=1);32<=h&&246>=h&&(p=h-139,n=1);247<=h&&250>=h&&(p=256*(h-247)+g+108,n=2);251<=h&&254>=h&&(p=256*-(h-251)-g-108,n=2);255==h&&(p=e.readInt(b,a+1)/65535,n=5);c.val=null!=p?p:"o"+d;c.size=n};f.CFF.readCharString=function(b,a,c){c=a+c;for(var e=f._bin,h=[];a<c;){var g=b[a],d=b[a+1];b[a+2];b[a+3];b[a+4];var m=1,p=null,k=null;20>=g&&(p=g,m=1);12==g&&(p=100*g+d,m=2);19!=g&&20!=g||(p=g,m=2);21<=g&&27>=g&&(p=g,m=1);28==g&&(k=e.readShort(b,a+1),m=3);29<=g&&31>=g&&(p=g,m=1);32<=g&&246>=g&&(k=
g-139,m=1);247<=g&&250>=g&&(k=256*(g-247)+d+108,m=2);251<=g&&254>=g&&(k=256*-(g-251)-d-108,m=2);255==g&&(k=e.readInt(b,a+1)/65535,m=5);h.push(null!=k?k:"o"+p);a+=m}return h};f.CFF.readDict=function(b,a,c){for(var e=f._bin,h={},g=[];a<c;){var d=b[a],m=b[a+1];b[a+2];b[a+3];b[a+4];var p=1,k=null,l=null;if(28==d&&(l=e.readShort(b,a+1),p=3),29==d&&(l=e.readInt(b,a+1),p=5),32<=d&&246>=d&&(l=d-139,p=1),247<=d&&250>=d&&(l=256*(d-247)+m+108,p=2),251<=d&&254>=d&&(l=256*-(d-251)-m-108,p=2),255==d)throw e.readInt(b,
a+1),"unknown number";if(30==d){l=[];for(p=1;;){var r=b[a+p];p++;var q=r>>4;r&=15;if(15!=q&&l.push(q),15!=r&&l.push(r),15==r)break}q="";r=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"];for(var t=0;t<l.length;t++)q+=r[l[t]];l=parseFloat(q)}21>=d&&(k="version Notice FullName FamilyName Weight FontBBox BlueValues OtherBlues FamilyBlues FamilyOtherBlues StdHW StdVW escape UniqueID XUID charset Encoding CharStrings Private Subrs defaultWidthX nominalWidthX".split(" ")[d],p=1,12==d)&&(k=
["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][m],p=2);null!=k?(h[k]=1==g.length?g[0]:g,g=[]):g.push(l);
a+=p}return h};f.cmap={};f.cmap.parse=function(b,a,c){b=new Uint8Array(b.buffer,a,c);a=0;c=f._bin;var e={};c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;var g=[];e.tables=[];for(var d=0;d<h;d++){var m=c.readUshort(b,a);a+=2;var k=c.readUshort(b,a);a+=2;var l=c.readUint(b,a);a+=4;var x="p"+m+"e"+k,r=g.indexOf(l);if(-1==r){var q;r=e.tables.length;g.push(l);var t=c.readUshort(b,l);0==t?q=f.cmap.parse0(b,l):4==t?q=f.cmap.parse4(b,l):6==t?q=f.cmap.parse6(b,l):12==t?q=f.cmap.parse12(b,l):console.debug("unknown format: "+
t,m,k,l);e.tables.push(q)}if(null!=e[x])throw"multiple tables for one platform+encoding";e[x]=r}return e};f.cmap.parse0=function(b,a){var c=f._bin,e={};e.format=c.readUshort(b,a);a+=2;var h=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;e.map=[];for(c=0;c<h-6;c++)e.map.push(b[a+c]);return e};f.cmap.parse4=function(b,a){var c=f._bin,e=a,h={};h.format=c.readUshort(b,a);a+=2;var g=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;d/=2;h.searchRange=c.readUshort(b,a);a+=2;h.entrySelector=
c.readUshort(b,a);a+=2;h.rangeShift=c.readUshort(b,a);a+=2;h.endCount=c.readUshorts(b,a,d);a=a+2*d+2;h.startCount=c.readUshorts(b,a,d);a+=2*d;h.idDelta=[];for(var m=0;m<d;m++)h.idDelta.push(c.readShort(b,a)),a+=2;h.idRangeOffset=c.readUshorts(b,a,d);a+=2*d;for(h.glyphIdArray=[];a<e+g;)h.glyphIdArray.push(c.readUshort(b,a)),a+=2;return h};f.cmap.parse6=function(b,a){var c=f._bin,e={};e.format=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;e.firstCode=c.readUshort(b,a);a+=2;var h=
c.readUshort(b,a);a+=2;e.glyphIdArray=[];for(var g=0;g<h;g++)e.glyphIdArray.push(c.readUshort(b,a)),a+=2;return e};f.cmap.parse12=function(b,a){var c=f._bin,e={};e.format=c.readUshort(b,a);a=a+2+2;c.readUint(b,a);a+=4;c.readUint(b,a);a+=4;var h=c.readUint(b,a);a+=4;e.groups=[];for(var g=0;g<h;g++){var d=a+12*g,m=c.readUint(b,d+0),k=c.readUint(b,d+4);d=c.readUint(b,d+8);e.groups.push([m,k,d])}return e};f.glyf={};f.glyf.parse=function(b,a,c,e){b=[];for(a=0;a<e.maxp.numGlyphs;a++)b.push(null);return b};
f.glyf._parseGlyf=function(b,a){var c=f._bin,e=b._data,h=f._tabOffset(e,"glyf",b._offset)+b.loca[a];if(b.loca[a]==b.loca[a+1])return null;b={};if(b.noc=c.readShort(e,h),h+=2,b.xMin=c.readShort(e,h),h+=2,b.yMin=c.readShort(e,h),h+=2,b.xMax=c.readShort(e,h),h+=2,b.yMax=c.readShort(e,h),h+=2,b.xMin>=b.xMax||b.yMin>=b.yMax)return null;if(0<b.noc){b.endPts=[];for(a=0;a<b.noc;a++)b.endPts.push(c.readUshort(e,h)),h+=2;a=c.readUshort(e,h);if(h+=2,e.length-h<a)return null;b.instructions=c.readBytes(e,h,a);
h+=a;var g=b.endPts[b.noc-1]+1;b.flags=[];for(a=0;a<g;a++){var d=e[h];if(h++,b.flags.push(d),0!=(8&d)){var m=e[h];h++;for(var k=0;k<m;k++)b.flags.push(d),a++}}b.xs=[];for(a=0;a<g;a++)d=0!=(2&b.flags[a]),m=0!=(16&b.flags[a]),d?(b.xs.push(m?e[h]:-e[h]),h++):m?b.xs.push(0):(b.xs.push(c.readShort(e,h)),h+=2);b.ys=[];for(a=0;a<g;a++)d=0!=(4&b.flags[a]),m=0!=(32&b.flags[a]),d?(b.ys.push(m?e[h]:-e[h]),h++):m?b.ys.push(0):(b.ys.push(c.readShort(e,h)),h+=2);for(a=h=e=0;a<g;a++)e+=b.xs[a],h+=b.ys[a],b.xs[a]=
e,b.ys[a]=h}else{b.parts=[];do a=c.readUshort(e,h),h+=2,g={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1},(b.parts.push(g),g.glyphIndex=c.readUshort(e,h),h+=2,1&a)?(d=c.readShort(e,h),h+=2,m=c.readShort(e,h),h+=2):(d=c.readInt8(e,h),h++,m=c.readInt8(e,h),h++),2&a?(g.m.tx=d,g.m.ty=m):(g.p1=d,g.p2=m),8&a?(g.m.a=g.m.d=c.readF2dot14(e,h),h+=2):64&a?(g.m.a=c.readF2dot14(e,h),h+=2,g.m.d=c.readF2dot14(e,h),h+=2):128&a&&(g.m.a=c.readF2dot14(e,h),h+=2,g.m.b=c.readF2dot14(e,h),h+=2,g.m.c=c.readF2dot14(e,h),h+=
2,g.m.d=c.readF2dot14(e,h),h+=2);while(32&a);if(256&a)for(c=c.readUshort(e,h),h+=2,b.instr=[],a=0;a<c;a++)b.instr.push(e[h]),h++}return b};f.GDEF={};f.GDEF.parse=function(b,a,c,e){c=f._bin.readUshort(b,a+4);return{glyphClassDef:0===c?null:f._lctf.readClassDef(b,a+c)}};f.GPOS={};f.GPOS.parse=function(b,a,c,e){return f._lctf.parse(b,a,c,e,f.GPOS.subt)};f.GPOS.subt=function(b,a,c,e){var h=f._bin,g=c,d={};if(d.fmt=h.readUshort(b,c),c+=2,1==a||2==a||3==a||7==a||8==a&&2>=d.fmt){var m=h.readUshort(b,c);
c+=2;d.coverage=f._lctf.readCoverage(b,m+g)}if(1==a&&1==d.fmt)e=h.readUshort(b,c),0!=e&&(d.pos=f.GPOS.readValueRecord(b,c+2,e));else if(2==a&&1<=d.fmt&&2>=d.fmt){e=h.readUshort(b,c);c+=2;a=h.readUshort(b,c);c+=2;m=f._lctf.numOfOnes(e);var k=f._lctf.numOfOnes(a);if(1==d.fmt){d.pairsets=[];var l=h.readUshort(b,c);c+=2;for(var x=0;x<l;x++){var r=g+h.readUshort(b,c);c+=2;var q=h.readUshort(b,r);r+=2;for(var t=[],v=0;v<q;v++){var w=h.readUshort(b,r);r+=2;0!=e&&(u=f.GPOS.readValueRecord(b,r,e),r+=2*m);
0!=a&&(G=f.GPOS.readValueRecord(b,r,a),r+=2*k);t.push({gid2:w,val1:u,val2:G})}d.pairsets.push(t)}}if(2==d.fmt)for(u=h.readUshort(b,c),c+=2,G=h.readUshort(b,c),c+=2,l=h.readUshort(b,c),c+=2,h=h.readUshort(b,c),c+=2,d.classDef1=f._lctf.readClassDef(b,g+u),d.classDef2=f._lctf.readClassDef(b,g+G),d.matrix=[],x=0;x<l;x++){g=[];for(v=0;v<h;v++){var u=null,G=null;0!=e&&(u=f.GPOS.readValueRecord(b,c,e),c+=2*m);0!=a&&(G=f.GPOS.readValueRecord(b,c,a),c+=2*k);g.push({val1:u,val2:G})}d.matrix.push(g)}}else if(4==
a&&1==d.fmt)d.markCoverage=f._lctf.readCoverage(b,h.readUshort(b,c)+g),d.baseCoverage=f._lctf.readCoverage(b,h.readUshort(b,c+2)+g),d.markClassCount=h.readUshort(b,c+4),d.markArray=f.GPOS.readMarkArray(b,h.readUshort(b,c+6)+g),d.baseArray=f.GPOS.readBaseArray(b,h.readUshort(b,c+8)+g,d.markClassCount);else if(6==a&&1==d.fmt)d.mark1Coverage=f._lctf.readCoverage(b,h.readUshort(b,c)+g),d.mark2Coverage=f._lctf.readCoverage(b,h.readUshort(b,c+2)+g),d.markClassCount=h.readUshort(b,c+4),d.mark1Array=f.GPOS.readMarkArray(b,
h.readUshort(b,c+6)+g),d.mark2Array=f.GPOS.readBaseArray(b,h.readUshort(b,c+8)+g,d.markClassCount);else{if(9==a&&1==d.fmt){d=h.readUshort(b,c);c=h.readUint(b,c+2);if(9==e.ltype)e.ltype=d;else if(e.ltype!=d)throw"invalid extension substitution";return f.GPOS.subt(b,e.ltype,g+c)}console.debug("unsupported GPOS table LookupType",a,"format",d.fmt)}return d};f.GPOS.readValueRecord=function(b,a,c){var e=f._bin,h=[];return h.push(1&c?e.readShort(b,a):0),a+=1&c?2:0,h.push(2&c?e.readShort(b,a):0),a+=2&c?2:
0,h.push(4&c?e.readShort(b,a):0),a+=4&c?2:0,h.push(8&c?e.readShort(b,a):0),h};f.GPOS.readBaseArray=function(b,a,c){var e=f._bin,h=[],g=a,d=e.readUshort(b,a);a+=2;for(var m=0;m<d;m++){for(var k=[],l=0;l<c;l++)k.push(f.GPOS.readAnchorRecord(b,g+e.readUshort(b,a))),a+=2;h.push(k)}return h};f.GPOS.readMarkArray=function(b,a){var c=f._bin,e=[],h=a,g=c.readUshort(b,a);a+=2;for(var d=0;d<g;d++){var m=f.GPOS.readAnchorRecord(b,c.readUshort(b,a+2)+h);m.markClass=c.readUshort(b,a);e.push(m);a+=4}return e};
f.GPOS.readAnchorRecord=function(b,a){var c=f._bin,e={};return e.fmt=c.readUshort(b,a),e.x=c.readShort(b,a+2),e.y=c.readShort(b,a+4),e};f.GSUB={};f.GSUB.parse=function(b,a,c,e){return f._lctf.parse(b,a,c,e,f.GSUB.subt)};f.GSUB.subt=function(b,a,c,e){var h=f._bin,g=c,d={};if(d.fmt=h.readUshort(b,c),c+=2,1!=a&&2!=a&&4!=a&&5!=a&&6!=a)return null;if(1==a||2==a||4==a||5==a&&2>=d.fmt||6==a&&2>=d.fmt){var m=h.readUshort(b,c);c+=2;d.coverage=f._lctf.readCoverage(b,g+m)}if(1==a&&1<=d.fmt&&2>=d.fmt)1==d.fmt?
d.delta=h.readShort(b,c):2==d.fmt&&(a=h.readUshort(b,c),d.newg=h.readUshorts(b,c+2,a));else if(2==a&&1==d.fmt)for(a=h.readUshort(b,c),c+=2,d.seqs=[],e=0;e<a;e++){m=h.readUshort(b,c)+g;c+=2;var k=h.readUshort(b,m);d.seqs.push(h.readUshorts(b,m+2,k))}else if(4==a)for(d.vals=[],a=h.readUshort(b,c),c+=2,e=0;e<a;e++)m=h.readUshort(b,c),c+=2,d.vals.push(f.GSUB.readLigatureSet(b,g+m));else if(5==a&&2==d.fmt){if(2==d.fmt)for(e=h.readUshort(b,c),c+=2,d.cDef=f._lctf.readClassDef(b,g+e),d.scset=[],a=h.readUshort(b,
c),c+=2,e=0;e<a;e++)m=h.readUshort(b,c),c+=2,d.scset.push(0==m?null:f.GSUB.readSubClassSet(b,g+m))}else if(6==a&&3==d.fmt){if(3==d.fmt){for(e=0;3>e;e++){a=h.readUshort(b,c);c+=2;m=[];for(k=0;k<a;k++)m.push(f._lctf.readCoverage(b,g+h.readUshort(b,c+2*k)));c+=2*a;0==e&&(d.backCvg=m);1==e&&(d.inptCvg=m);2==e&&(d.ahedCvg=m)}a=h.readUshort(b,c);d.lookupRec=f.GSUB.readSubstLookupRecords(b,c+2,a)}}else{if(7==a&&1==d.fmt){d=h.readUshort(b,c);c=h.readUint(b,c+2);if(9==e.ltype)e.ltype=d;else if(e.ltype!=d)throw"invalid extension substitution";
return f.GSUB.subt(b,e.ltype,g+c)}console.debug("unsupported GSUB table LookupType",a,"format",d.fmt)}return d};f.GSUB.readSubClassSet=function(b,a){var c=f._bin.readUshort,e=a,d=[],g=c(b,a);a+=2;for(var k=0;k<g;k++){var m=c(b,a);a+=2;d.push(f.GSUB.readSubClassRule(b,e+m))}return d};f.GSUB.readSubClassRule=function(b,a){var c=f._bin.readUshort,e={},d=c(b,a),g=c(b,a+=2);a+=2;e.input=[];for(var k=0;k<d-1;k++)e.input.push(c(b,a)),a+=2;return e.substLookupRecords=f.GSUB.readSubstLookupRecords(b,a,g),
e};f.GSUB.readSubstLookupRecords=function(b,a,c){for(var e=f._bin.readUshort,d=[],g=0;g<c;g++)d.push(e(b,a),e(b,a+2)),a+=4;return d};f.GSUB.readChainSubClassSet=function(b,a){var c=f._bin,e=a,d=[],g=c.readUshort(b,a);a+=2;for(var k=0;k<g;k++){var m=c.readUshort(b,a);a+=2;d.push(f.GSUB.readChainSubClassRule(b,e+m))}return d};f.GSUB.readChainSubClassRule=function(b,a){for(var c=f._bin,e={},d=["backtrack","input","lookahead"],g=0;g<d.length;g++){var k=c.readUshort(b,a);a+=2;1==g&&k--;e[d[g]]=c.readUshorts(b,
a,k);a+=2*e[d[g]].length}k=c.readUshort(b,a);return a+=2,e.subst=c.readUshorts(b,a,2*k),e};f.GSUB.readLigatureSet=function(b,a){var c=f._bin,e=a,d=[],g=c.readUshort(b,a);a+=2;for(var k=0;k<g;k++){var m=c.readUshort(b,a);a+=2;d.push(f.GSUB.readLigature(b,e+m))}return d};f.GSUB.readLigature=function(b,a){var c=f._bin,e={chain:[]};e.nglyph=c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;for(var g=0;g<d-1;g++)e.chain.push(c.readUshort(b,a)),a+=2;return e};f.head={};f.head.parse=function(b,a,c){c=
f._bin;var e={};return c.readFixed(b,a),a+=4,e.fontRevision=c.readFixed(b,a),a+=4,c.readUint(b,a),a+=4,c.readUint(b,a),a+=4,e.flags=c.readUshort(b,a),a+=2,e.unitsPerEm=c.readUshort(b,a),a+=2,e.created=c.readUint64(b,a),a+=8,e.modified=c.readUint64(b,a),a+=8,e.xMin=c.readShort(b,a),a+=2,e.yMin=c.readShort(b,a),a+=2,e.xMax=c.readShort(b,a),a+=2,e.yMax=c.readShort(b,a),a+=2,e.macStyle=c.readUshort(b,a),a+=2,e.lowestRecPPEM=c.readUshort(b,a),a+=2,e.fontDirectionHint=c.readShort(b,a),a+=2,e.indexToLocFormat=
c.readShort(b,a),a+=2,e.glyphDataFormat=c.readShort(b,a),e};f.hhea={};f.hhea.parse=function(b,a,c){c=f._bin;var e={};return c.readFixed(b,a),a+=4,e.ascender=c.readShort(b,a),a+=2,e.descender=c.readShort(b,a),a+=2,e.lineGap=c.readShort(b,a),a+=2,e.advanceWidthMax=c.readUshort(b,a),a+=2,e.minLeftSideBearing=c.readShort(b,a),a+=2,e.minRightSideBearing=c.readShort(b,a),a+=2,e.xMaxExtent=c.readShort(b,a),a+=2,e.caretSlopeRise=c.readShort(b,a),a+=2,e.caretSlopeRun=c.readShort(b,a),a+=2,e.caretOffset=c.readShort(b,
a),a+=2,a+=8,e.metricDataFormat=c.readShort(b,a),a+=2,e.numberOfHMetrics=c.readUshort(b,a),e};f.hmtx={};f.hmtx.parse=function(b,a,c,e){c=f._bin;for(var d={aWidth:[],lsBearing:[]},g=0,k=0,m=0;m<e.maxp.numGlyphs;m++)m<e.hhea.numberOfHMetrics&&(g=c.readUshort(b,a),a+=2,k=c.readShort(b,a),a+=2),d.aWidth.push(g),d.lsBearing.push(k);return d};f.kern={};f.kern.parse=function(b,a,c,e){var d=f._bin,g=d.readUshort(b,a);if(a+=2,1==g)return f.kern.parseV1(b,a-2,c,e);c=d.readUshort(b,a);a+=2;e={glyph1:[],rval:[]};
for(g=0;g<c;g++){a+=2;d.readUshort(b,a);a+=2;var k=d.readUshort(b,a);a+=2;k>>>=8;if(0!=(k&=15))throw"unknown kern table format: "+k;a=f.kern.readFormat0(b,a,e)}return e};f.kern.parseV1=function(b,a,c,e){c=f._bin;c.readFixed(b,a);a+=4;e=c.readUint(b,a);a+=4;for(var d={glyph1:[],rval:[]},g=0;g<e;g++){c.readUint(b,a);a+=4;var k=c.readUshort(b,a);a+=2;c.readUshort(b,a);a+=2;k>>>=8;if(0!=(k&=15))throw"unknown kern table format: "+k;a=f.kern.readFormat0(b,a,d)}return d};f.kern.readFormat0=function(b,a,
c){var e=f._bin,d=-1,g=e.readUshort(b,a);a+=2;e.readUshort(b,a);a+=2;e.readUshort(b,a);a+=2;e.readUshort(b,a);a+=2;for(var k=0;k<g;k++){var m=e.readUshort(b,a);a+=2;var p=e.readUshort(b,a);a+=2;var l=e.readShort(b,a);a+=2;m!=d&&(c.glyph1.push(m),c.rval.push({glyph2:[],vals:[]}));d=c.rval[c.rval.length-1];d.glyph2.push(p);d.vals.push(l);d=m}return a};f.loca={};f.loca.parse=function(b,a,c,e){c=f._bin;var d=[],g=e.head.indexToLocFormat;e=e.maxp.numGlyphs+1;if(0==g)for(var k=0;k<e;k++)d.push(c.readUshort(b,
a+(k<<1))<<1);if(1==g)for(k=0;k<e;k++)d.push(c.readUint(b,a+(k<<2)));return d};f.maxp={};f.maxp.parse=function(b,a,c){c=f._bin;var e={},d=c.readUint(b,a);return a+=4,e.numGlyphs=c.readUshort(b,a),a+=2,65536==d&&(e.maxPoints=c.readUshort(b,a),a+=2,e.maxContours=c.readUshort(b,a),a+=2,e.maxCompositePoints=c.readUshort(b,a),a+=2,e.maxCompositeContours=c.readUshort(b,a),a+=2,e.maxZones=c.readUshort(b,a),a+=2,e.maxTwilightPoints=c.readUshort(b,a),a+=2,e.maxStorage=c.readUshort(b,a),a+=2,e.maxFunctionDefs=
c.readUshort(b,a),a+=2,e.maxInstructionDefs=c.readUshort(b,a),a+=2,e.maxStackElements=c.readUshort(b,a),a+=2,e.maxSizeOfInstructions=c.readUshort(b,a),a+=2,e.maxComponentElements=c.readUshort(b,a),a+=2,e.maxComponentDepth=c.readUshort(b,a)),e};f.name={};f.name.parse=function(b,a,c){c=f._bin;var e={};c.readUshort(b,a);a+=2;var d=c.readUshort(b,a);a+=2;c.readUshort(b,a);for(var g,k="copyright fontFamily fontSubfamily ID fullName version postScriptName trademark manufacturer designer description urlVendor urlDesigner licence licenceURL --- typoFamilyName typoSubfamilyName compatibleFull sampleText postScriptCID wwsFamilyName wwsSubfamilyName lightPalette darkPalette".split(" "),
m=a+=2,p=0;p<d;p++){var l=c.readUshort(b,a);a+=2;var x=c.readUshort(b,a);a+=2;var r=c.readUshort(b,a);a+=2;var q=c.readUshort(b,a);a+=2;var t=c.readUshort(b,a);a+=2;var v=c.readUshort(b,a);a+=2;var w=k[q];v=m+12*d+v;if(0==l)t=c.readUnicode(b,v,t/2);else if(3==l&&0==x)t=c.readUnicode(b,v,t/2);else if(0==x)t=c.readASCII(b,v,t);else if(1==x)t=c.readUnicode(b,v,t/2);else if(3==x)t=c.readUnicode(b,v,t/2);else{if(1!=l)throw"unknown encoding "+x+", platformID: "+l;t=c.readASCII(b,v,t);console.debug("reading unknown MAC encoding "+
x+" as ASCII")}l="p"+l+","+r.toString(16);null==e[l]&&(e[l]={});e[l][void 0!==w?w:q]=t;e[l]._lang=r}for(var u in e)if(null!=e[u].postScriptName&&1033==e[u]._lang)return e[u];for(u in e)if(null!=e[u].postScriptName&&0==e[u]._lang)return e[u];for(u in e)if(null!=e[u].postScriptName&&3084==e[u]._lang)return e[u];for(u in e)if(null!=e[u].postScriptName)return e[u];for(u in e){g=u;break}return console.debug("returning name table with languageID "+e[g]._lang),e[g]};f["OS/2"]={};f["OS/2"].parse=function(b,
a,c){c=f._bin.readUshort(b,a);a+=2;var e={};if(0==c)f["OS/2"].version0(b,a,e);else if(1==c)f["OS/2"].version1(b,a,e);else if(2==c||3==c||4==c)f["OS/2"].version2(b,a,e);else{if(5!=c)throw"unknown OS/2 table version: "+c;f["OS/2"].version5(b,a,e)}return e};f["OS/2"].version0=function(b,a,c){var e=f._bin;return c.xAvgCharWidth=e.readShort(b,a),a+=2,c.usWeightClass=e.readUshort(b,a),a+=2,c.usWidthClass=e.readUshort(b,a),a+=2,c.fsType=e.readUshort(b,a),a+=2,c.ySubscriptXSize=e.readShort(b,a),a+=2,c.ySubscriptYSize=
e.readShort(b,a),a+=2,c.ySubscriptXOffset=e.readShort(b,a),a+=2,c.ySubscriptYOffset=e.readShort(b,a),a+=2,c.ySuperscriptXSize=e.readShort(b,a),a+=2,c.ySuperscriptYSize=e.readShort(b,a),a+=2,c.ySuperscriptXOffset=e.readShort(b,a),a+=2,c.ySuperscriptYOffset=e.readShort(b,a),a+=2,c.yStrikeoutSize=e.readShort(b,a),a+=2,c.yStrikeoutPosition=e.readShort(b,a),a+=2,c.sFamilyClass=e.readShort(b,a),a+=2,c.panose=e.readBytes(b,a,10),a+=10,c.ulUnicodeRange1=e.readUint(b,a),a+=4,c.ulUnicodeRange2=e.readUint(b,
a),a+=4,c.ulUnicodeRange3=e.readUint(b,a),a+=4,c.ulUnicodeRange4=e.readUint(b,a),a+=4,c.achVendID=[e.readInt8(b,a),e.readInt8(b,a+1),e.readInt8(b,a+2),e.readInt8(b,a+3)],a+=4,c.fsSelection=e.readUshort(b,a),a+=2,c.usFirstCharIndex=e.readUshort(b,a),a+=2,c.usLastCharIndex=e.readUshort(b,a),a+=2,c.sTypoAscender=e.readShort(b,a),a+=2,c.sTypoDescender=e.readShort(b,a),a+=2,c.sTypoLineGap=e.readShort(b,a),a+=2,c.usWinAscent=e.readUshort(b,a),a+=2,c.usWinDescent=e.readUshort(b,a),a+2};f["OS/2"].version1=
function(b,a,c){var e=f._bin;return a=f["OS/2"].version0(b,a,c),c.ulCodePageRange1=e.readUint(b,a),a+=4,c.ulCodePageRange2=e.readUint(b,a),a+4};f["OS/2"].version2=function(b,a,c){var e=f._bin;return a=f["OS/2"].version1(b,a,c),c.sxHeight=e.readShort(b,a),a+=2,c.sCapHeight=e.readShort(b,a),a+=2,c.usDefault=e.readUshort(b,a),a+=2,c.usBreak=e.readUshort(b,a),a+=2,c.usMaxContext=e.readUshort(b,a),a+2};f["OS/2"].version5=function(b,a,c){var e=f._bin;return a=f["OS/2"].version2(b,a,c),c.usLowerOpticalPointSize=
e.readUshort(b,a),a+=2,c.usUpperOpticalPointSize=e.readUshort(b,a),a+2};f.post={};f.post.parse=function(b,a,c){c=f._bin;var e={};return e.version=c.readFixed(b,a),a+=4,e.italicAngle=c.readFixed(b,a),a+=4,e.underlinePosition=c.readShort(b,a),a+=2,e.underlineThickness=c.readShort(b,a),e};null==f&&(f={});null==f.U&&(f.U={});f.U.codeToGlyph=function(b,a){b=b.cmap;var c=-1;if(null!=b.p0e4?c=b.p0e4:null!=b.p3e1?c=b.p3e1:null!=b.p1e0?c=b.p1e0:null!=b.p0e3&&(c=b.p0e3),-1==c)throw"no familiar platform and encoding!";
b=b.tables[c];if(0==b.format)return a>=b.map.length?0:b.map[a];if(4==b.format){var e=-1;for(c=0;c<b.endCount.length;c++)if(a<=b.endCount[c]){e=c;break}return-1==e||b.startCount[e]>a?0:65535&(0!=b.idRangeOffset[e]?b.glyphIdArray[a-b.startCount[e]+(b.idRangeOffset[e]>>1)-(b.idRangeOffset.length-e)]:a+b.idDelta[e])}if(12==b.format){if(a>b.groups[b.groups.length-1][1])return 0;for(c=0;c<b.groups.length;c++)if(e=b.groups[c],e[0]<=a&&a<=e[1])return e[2]+(a-e[0]);return 0}throw"unknown cmap table format "+
b.format;};f.U.glyphToPath=function(b,a){var c={cmds:[],crds:[]};if(b.SVG&&b.SVG.entries[a]){var e=b.SVG.entries[a];return null==e?c:("string"==typeof e&&(e=f.SVG.toPath(e),b.SVG.entries[a]=e),e)}if(b.CFF){e={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:b.CFF.Private?b.CFF.Private.defaultWidthX:0,open:!1};var d=b.CFF,g=b.CFF.Private;if(d.ROS){for(g=0;d.FDSelect[g+2]<=a;)g+=2;g=d.FDArray[d.FDSelect[g+1]].Private}f.U._drawCFF(b.CFF.CharStrings[a],e,d,g,c)}else b.glyf&&f.U._drawGlyf(a,b,c);return c};
f.U._drawGlyf=function(b,a,c){var e=a.glyf[b];null==e&&(e=a.glyf[b]=f.glyf._parseGlyf(a,b));null!=e&&(-1<e.noc?f.U._simpleGlyph(e,c):f.U._compoGlyph(e,a,c))};f.U._simpleGlyph=function(b,a){for(var c=0;c<b.noc;c++){for(var e=0==c?0:b.endPts[c-1]+1,d=b.endPts[c],g=e;g<=d;g++){var k=g==e?d:g-1,m=g==d?e:g+1,l=1&b.flags[g],y=1&b.flags[k],x=1&b.flags[m],r=b.xs[g],q=b.ys[g];if(g==e)if(l){if(!y){f.U.P.moveTo(a,r,q);continue}f.U.P.moveTo(a,b.xs[k],b.ys[k])}else y?f.U.P.moveTo(a,b.xs[k],b.ys[k]):f.U.P.moveTo(a,
(b.xs[k]+r)/2,(b.ys[k]+q)/2);l?y&&f.U.P.lineTo(a,r,q):x?f.U.P.qcurveTo(a,r,q,b.xs[m],b.ys[m]):f.U.P.qcurveTo(a,r,q,(r+b.xs[m])/2,(q+b.ys[m])/2)}f.U.P.closePath(a)}};f.U._compoGlyph=function(b,a,c){for(var e=0;e<b.parts.length;e++){var d={cmds:[],crds:[]},g=b.parts[e];f.U._drawGlyf(g.glyphIndex,a,d);g=g.m;for(var k=0;k<d.crds.length;k+=2){var m=d.crds[k],l=d.crds[k+1];c.crds.push(m*g.a+l*g.b+g.tx);c.crds.push(m*g.c+l*g.d+g.ty)}for(k=0;k<d.cmds.length;k++)c.cmds.push(d.cmds[k])}};f.U._getGlyphClass=
function(b,a){b=f._lctf.getInterval(a,b);return-1==b?0:a[b+2]};f.U._applySubs=function(b,a,c,e){for(var d=b.length-a-1,g=0;g<c.tabs.length;g++)if(null!=c.tabs[g]){var k,m=c.tabs[g];if(!m.coverage||-1!=(k=f._lctf.coverageIndex(m.coverage,b[a])))if(1==c.ltype)b[a],1==m.fmt?b[a]+=m.delta:b[a]=m.newg[k];else if(4==c.ltype)for(var l=m.vals[k],y=0;y<l.length;y++){var x=l[y];m=x.chain.length;if(!(m>d)){for(var r=!0,q=0,t=0;t<m;t++){for(;-1==b[a+q+(1+t)];)q++;x.chain[t]!=b[a+q+(1+t)]&&(r=!1)}if(r){b[a]=x.nglyph;
for(t=0;t<m+q;t++)b[a+t+1]=-1;break}}}else if(5==c.ltype&&2==m.fmt)for(l=f._lctf.getInterval(m.cDef,b[a]),q=m.scset[m.cDef[l+2]],x=0;x<q.length;x++){y=q[x];var v=y.input;if(!(v.length>d)){r=!0;for(t=0;t<v.length;t++){var w=f._lctf.getInterval(m.cDef,b[a+1+t]);if(-1==l&&m.cDef[w+2]!=v[t]){r=!1;break}}if(r)for(r=y.substLookupRecords,y=0;y<r.length;y+=2)r[y],r[y+1]}}else if(6==c.ltype&&3==m.fmt&&f.U._glsCovered(b,m.backCvg,a-m.backCvg.length)&&f.U._glsCovered(b,m.inptCvg,a)&&f.U._glsCovered(b,m.ahedCvg,
a+m.inptCvg.length))for(r=m.lookupRec,x=0;x<r.length;x+=2)l=r[x],f.U._applySubs(b,a+l,e[r[x+1]],e)}};f.U._glsCovered=function(b,a,c){for(var e=0;e<a.length;e++)if(-1==f._lctf.coverageIndex(a[e],b[c+e]))return!1;return!0};f.U.glyphsToPath=function(b,a,c){for(var e={cmds:[],crds:[]},d=0,g=0;g<a.length;g++){var k=a[g];if(-1!=k){for(var m=g<a.length-1&&-1!=a[g+1]?a[g+1]:0,l=f.U.glyphToPath(b,k),y=0;y<l.crds.length;y+=2)e.crds.push(l.crds[y]+d),e.crds.push(l.crds[y+1]);c&&e.cmds.push(c);for(y=0;y<l.cmds.length;y++)e.cmds.push(l.cmds[y]);
c&&e.cmds.push("X");d+=b.hmtx.aWidth[k];g<a.length-1&&(d+=f.U.getPairAdjustment(b,k,m))}}return e};f.U.P={};f.U.P.moveTo=function(b,a,c){b.cmds.push("M");b.crds.push(a,c)};f.U.P.lineTo=function(b,a,c){b.cmds.push("L");b.crds.push(a,c)};f.U.P.curveTo=function(b,a,c,e,d,f,k){b.cmds.push("C");b.crds.push(a,c,e,d,f,k)};f.U.P.qcurveTo=function(b,a,c,e,d){b.cmds.push("Q");b.crds.push(a,c,e,d)};f.U.P.closePath=function(b){b.cmds.push("Z")};f.U._drawCFF=function(b,a,c,e,d){for(var g=a.stack,h=a.nStems,k=
a.haveWidth,l=a.width,y=a.open,x=0,r=a.x,q=a.y,t=0,v=0,w=0,u=0,G=0,J=0,C=0,z=0,H=0,B=0,L={val:0,size:0};x<b.length;){f.CFF.getCharString(b,x,L);var A=L.val;if(x+=L.size,"o1"==A||"o18"==A)0!=g.length%2&&!k&&(l=g.shift()+e.nominalWidthX),h+=g.length>>1,g.length=0,k=!0;else if("o3"==A||"o23"==A)0!=g.length%2&&!k&&(l=g.shift()+e.nominalWidthX),h+=g.length>>1,g.length=0,k=!0;else if("o4"==A)1<g.length&&!k&&(l=g.shift()+e.nominalWidthX,k=!0),y&&f.U.P.closePath(d),q+=g.pop(),f.U.P.moveTo(d,r,q),y=!0;else if("o5"==
A)for(;0<g.length;)r+=g.shift(),q+=g.shift(),f.U.P.lineTo(d,r,q);else if("o6"==A||"o7"==A){var M=g.length,K="o6"==A;for(A=0;A<M;A++){var F=g.shift();K?r+=F:q+=F;K=!K;f.U.P.lineTo(d,r,q)}}else if("o8"==A||"o24"==A){M=g.length;for(K=0;K+6<=M;)t=r+g.shift(),v=q+g.shift(),w=t+g.shift(),u=v+g.shift(),r=w+g.shift(),q=u+g.shift(),f.U.P.curveTo(d,t,v,w,u,r,q),K+=6;"o24"==A&&(r+=g.shift(),q+=g.shift(),f.U.P.lineTo(d,r,q))}else{if("o11"==A)break;if("o1234"==A||"o1235"==A||"o1236"==A||"o1237"==A)"o1234"==A&&
(v=q,w=(t=r+g.shift())+g.shift(),B=u=v+g.shift(),J=u,z=q,r=(C=(G=(H=w+g.shift())+g.shift())+g.shift())+g.shift(),f.U.P.curveTo(d,t,v,w,u,H,B),f.U.P.curveTo(d,G,J,C,z,r,q)),"o1235"==A&&(t=r+g.shift(),v=q+g.shift(),w=t+g.shift(),u=v+g.shift(),H=w+g.shift(),B=u+g.shift(),G=H+g.shift(),J=B+g.shift(),C=G+g.shift(),z=J+g.shift(),r=C+g.shift(),q=z+g.shift(),g.shift(),f.U.P.curveTo(d,t,v,w,u,H,B),f.U.P.curveTo(d,G,J,C,z,r,q)),"o1236"==A&&(t=r+g.shift(),v=q+g.shift(),w=t+g.shift(),B=u=v+g.shift(),J=u,C=(G=
(H=w+g.shift())+g.shift())+g.shift(),z=J+g.shift(),r=C+g.shift(),f.U.P.curveTo(d,t,v,w,u,H,B),f.U.P.curveTo(d,G,J,C,z,r,q)),"o1237"==A&&(t=r+g.shift(),v=q+g.shift(),w=t+g.shift(),u=v+g.shift(),H=w+g.shift(),B=u+g.shift(),G=H+g.shift(),J=B+g.shift(),C=G+g.shift(),z=J+g.shift(),Math.abs(C-r)>Math.abs(z-q)?r=C+g.shift():q=z+g.shift(),f.U.P.curveTo(d,t,v,w,u,H,B),f.U.P.curveTo(d,G,J,C,z,r,q));else if("o14"==A){if(0<g.length&&!k&&(l=g.shift()+c.nominalWidthX,k=!0),4==g.length)M=g.shift(),K=g.shift(),F=
g.shift(),A=g.shift(),F=f.CFF.glyphBySE(c,F),A=f.CFF.glyphBySE(c,A),f.U._drawCFF(c.CharStrings[F],a,c,e,d),a.x=M,a.y=K,f.U._drawCFF(c.CharStrings[A],a,c,e,d);y&&(f.U.P.closePath(d),y=!1)}else if("o19"==A||"o20"==A)0!=g.length%2&&!k&&(l=g.shift()+e.nominalWidthX),h+=g.length>>1,g.length=0,k=!0,x+=h+7>>3;else if("o21"==A)2<g.length&&!k&&(l=g.shift()+e.nominalWidthX,k=!0),q+=g.pop(),r+=g.pop(),y&&f.U.P.closePath(d),f.U.P.moveTo(d,r,q),y=!0;else if("o22"==A)1<g.length&&!k&&(l=g.shift()+e.nominalWidthX,
k=!0),r+=g.pop(),y&&f.U.P.closePath(d),f.U.P.moveTo(d,r,q),y=!0;else if("o25"==A){for(;6<g.length;)r+=g.shift(),q+=g.shift(),f.U.P.lineTo(d,r,q);t=r+g.shift();v=q+g.shift();w=t+g.shift();u=v+g.shift();r=w+g.shift();q=u+g.shift();f.U.P.curveTo(d,t,v,w,u,r,q)}else if("o26"==A)for(g.length%2&&(r+=g.shift());0<g.length;)t=r,v=q+g.shift(),r=w=t+g.shift(),q=(u=v+g.shift())+g.shift(),f.U.P.curveTo(d,t,v,w,u,r,q);else if("o27"==A)for(g.length%2&&(q+=g.shift());0<g.length;)v=q,w=(t=r+g.shift())+g.shift(),
u=v+g.shift(),r=w+g.shift(),q=u,f.U.P.curveTo(d,t,v,w,u,r,q);else if("o10"==A||"o29"==A)M="o10"==A?e:c,0==g.length?console.debug("error: empty stack"):(K=g.pop(),M=M.Subrs[K+M.Bias],a.x=r,a.y=q,a.nStems=h,a.haveWidth=k,a.width=l,a.open=y,f.U._drawCFF(M,a,c,e,d),r=a.x,q=a.y,h=a.nStems,k=a.haveWidth,l=a.width,y=a.open);else if("o30"==A||"o31"==A)for(M=g.length,A=(K=0,"o31"==A),K+=M-(M&=-3);K<M;)A?(v=q,w=(t=r+g.shift())+g.shift(),q=(u=v+g.shift())+g.shift(),5==M-K?(r=w+g.shift(),K++):r=w,A=!1):(t=r,
v=q+g.shift(),w=t+g.shift(),u=v+g.shift(),r=w+g.shift(),5==M-K?(q=u+g.shift(),K++):q=u,A=!0),f.U.P.curveTo(d,t,v,w,u,r,q),K+=4;else{if("o"==(A+"").charAt(0))throw console.debug("Unknown operation: "+A,b),A;g.push(A)}}}a.x=r;a.y=q;a.nStems=h;a.haveWidth=k;a.width=l;a.open=y};var k=f,l={Typr:k};return d.Typr=k,d.default=l,Object.defineProperty(d,"__esModule",{value:!0}),d}({}).Typr},function(){return function(d){var f=Uint8Array,k=Uint16Array,l=Uint32Array,b=new f([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,
3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new f([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),c=new f([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),e=function(a,b){for(var c=new k(31),d=0;31>d;++d)c[d]=b+=1<<a[d-1];a=new l(c[30]);for(d=1;30>d;++d)for(b=c[d];b<c[d+1];++b)a[b]=b-c[d]<<5|d;return[c,a]},h=e(b,2),g=h[0];h=h[1];g[28]=258;h[258]=28;var n=e(a,0)[0],m=new k(32768);for(e=0;32768>e;++e)h=(43690&e)>>>1|(21845&e)<<1,h=(61680&(h=(52428&h)>>>2|(13107&h)<<2))>>>4|(3855&h)<<
4,m[e]=((65280&h)>>>8|(255&h)<<8)>>>1;var p=function(a,b,c){for(var d=a.length,e=0,f=new k(b);e<d;++e)++f[a[e]-1];var g=new k(b);for(e=0;e<b;++e)g[e]=g[e-1]+f[e-1]<<1;if(c)for(c=new k(1<<b),f=15-b,e=0;e<d;++e){if(a[e]){var h=e<<4|a[e],l=b-a[e],t=g[a[e]-1]++<<l;for(l=t|(1<<l)-1;t<=l;++t)c[m[t]>>>f]=h}}else for(c=new k(d),e=0;e<d;++e)a[e]&&(c[e]=m[g[a[e]-1]++]>>>15-a[e]);return c};h=new f(288);for(e=0;144>e;++e)h[e]=8;for(e=144;256>e;++e)h[e]=9;for(e=256;280>e;++e)h[e]=7;for(e=280;288>e;++e)h[e]=8;
var y=new f(32);for(e=0;32>e;++e)y[e]=5;var x=p(h,9,1),r=p(y,5,1),q=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},t=function(a,b,c){var e=b/8|0;return(a[e]|a[e+1]<<8)>>(7&b)&c},v=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},w=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long",
"stream finishing","invalid zip data"],u=function(a,b,c){b=Error(b||w[a]);if(b.code=a,Error.captureStackTrace&&Error.captureStackTrace(b,u),!c)throw b;return b},G=function(e,d,h){var m=e.length;if(!m||h&&!h.l&&5>m)return d||new f(0);var w=!d||h,y=!h||h.i;h||(h={});d||(d=new f(3*m));var z,J=function(a){var b=d.length;a>b&&(a=new f(Math.max(2*b,a)),a.set(d),d=a)},G=h.f||0,F=h.p||0,C=h.b||0,O=h.l,P=h.d,V=h.m,N=h.n,E=8*m;do{if(!O){h.f=G=t(e,F,1);var D=t(e,F+1,3);if(F+=3,!D){F=e[(W=((z=F)/8|0)+(7&z&&1)+
4)-4]|e[W-3]<<8;D=W+F;if(D>m){y&&u(0);break}w&&J(C+F);d.set(e.subarray(W,D),C);h.b=C+=F;h.p=F=8*D;continue}if(1==D)O=x,P=r,V=9,N=5;else if(2==D){V=t(e,F,31)+257;P=t(e,F+10,15)+4;O=V+t(e,F+5,31)+1;F+=14;N=new f(O);var Q=new f(19);for(D=0;D<P;++D)Q[c[D]]=t(e,F+3*D,7);F+=3*P;D=q(Q);P=(1<<D)-1;var ua=p(Q,D,1);for(D=0;D<O;){var W;W=ua[t(e,F,P)];if(F+=15&W,16>(W>>>=4))N[D++]=W;else{var fa=Q=0;for(16==W?(fa=3+t(e,F,3),F+=2,Q=N[D-1]):17==W?(fa=3+t(e,F,7),F+=3):18==W&&(fa=11+t(e,F,127),F+=7);fa--;)N[D++]=
Q}}O=N.subarray(0,V);D=N.subarray(V);V=q(O);N=q(D);O=p(O,V,1);P=p(D,N,1)}else u(1);if(F>E){y&&u(0);break}}w&&J(C+131072);ua=(1<<V)-1;fa=(1<<N)-1;for(var va=F;;va=F){D=(Q=O[v(e,F)&ua])>>>4;if((F+=15&Q)>E){y&&u(0);break}if(Q||u(2),256>D)d[C++]=D;else{if(256==D){va=F;O=null;break}Q=D-254;if(264<D){var aa=b[D-=257];Q=t(e,F,(1<<aa)-1)+g[D];F+=aa}D=P[v(e,F)&fa];aa=D>>>4;D||u(3);F+=15&D;D=n[aa];3<aa&&(aa=a[aa],D+=v(e,F)&(1<<aa)-1,F+=aa);if(F>E){y&&u(0);break}w&&J(C+131072);for(Q=C+Q;C<Q;C+=4)d[C]=d[C-D],
d[C+1]=d[C+1-D],d[C+2]=d[C+2-D],d[C+3]=d[C+3-D];C=Q}}h.l=O;h.p=va;h.b=C;O&&(G=1,h.m=V,h.d=P,h.n=N)}while(!G);return C==d.length?d:function(a,b,c){(null==b||0>b)&&(b=0);(null==c||c>a.length)&&(c=a.length);var e=new (a instanceof k?k:a instanceof l?l:f)(c-b);return e.set(a.subarray(b,c)),e}(d,0,C)};e=new f(0);h="undefined"!=typeof TextDecoder&&new TextDecoder;try{h.decode(e,{stream:!0}),1}catch(J){}return d.convert_streams=function(a){function b(){var a=f.getUint16(g);return g+=2,a}function c(){var a=
f.getUint32(g);return g+=4,a}function e(a){q.setUint16(u,a);u+=2}function d(a){q.setUint32(u,a);u+=4}var f=new DataView(a),g=0;c();var h=c();c();var k=b();b();c();b();b();c();c();c();c();c();for(var l=0;Math.pow(2,l)<=k;)l++;l--;for(var m=16*Math.pow(2,l),t=16*k-m,p=12,n=[],r=0;r<k;r++)n.push({tag:c(),offset:c(),compLength:c(),origLength:c(),origChecksum:c()}),p+=16;var v,w=new Uint8Array(12+16*n.length+n.reduce(function(a,b){return a+b.origLength+4},0));r=w.buffer;var q=new DataView(r),u=0;return d(h),
e(k),e(m),e(l),e(t),n.forEach(function(a){d(a.tag);d(a.origChecksum);d(p);d(a.origLength);a.outOffset=p;0!=(p+=a.origLength)%4&&(p+=4-p%4)}),n.forEach(function(b){var c=a.slice(b.offset,b.offset+b.compLength);if(b.compLength!=b.origLength){var e=new Uint8Array(b.origLength);c=new Uint8Array(c,2);G(c,e)}else e=new Uint8Array(c);w.set(e,b.outOffset);e=0;0!=(p=b.outOffset+b.origLength)%4&&(e=4-p%4);w.set((new Uint8Array(e)).buffer,b.outOffset+b.origLength);v=p+e}),r.slice(0,v)},Object.defineProperty(d,
"__esModule",{value:!0}),d}({}).convert_streams},function(d,f){function k(a){if(!n){let a={R:2,L:1,D:4,C:16,U:32,T:8};n=new Map;for(let b in g){let c=0;g[b].split(",").forEach(e=>{let [d,f]=e.split("+");d=parseInt(d,36);f=f?parseInt(f,36):0;n.set(c+=d,a[b]);for(e=f;e--;)n.set(++c,a[b])})}}return n.get(a)||32}function l(a,b){let c=[];for(let e=0;e<b.length;e++){let f=b.codePointAt(e);65535<f&&e++;c.push(d.U.codeToGlyph(a,f))}if(a=a.GSUB){let {lookupList:e,featureList:f}=a,g,h=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,
l=[];f.forEach(a=>{if(h.test(a.tag))for(let h=0;h<a.tab.length;h++){if(l[a.tab[h]])continue;l[a.tab[h]]=!0;let t=e[a.tab[h]],p=/^(isol|init|fina|medi)$/.test(a.tag);if(p&&!g){{var f=b;let a=new Uint8Array(f.length),c=32,e=1,d=-1;for(let b=0;b<f.length;b++){let g=f.codePointAt(b),h=k(g)|0,l=1;h&8||(c&21?h&22?(l=3,1!==e&&3!==e||a[d]++):h&33&&(2===e||4===e)&&a[d]--:c&34&&(2===e||4===e)&&a[d]--,e=a[b]=l,c=h,d=b,65535<g&&b++)}g=a}}for(f=0;f<c.length;f++)g&&p&&m[g[f]]!==a.tag||d.U._applySubs(c,f,t,e)}})}return c}
function b(b,c){function e(a){for(let b=k-1;0<=b;b--)if(-1!==c[b]&&(!a||a(c[b])))return b;return-1}function f(c){return 1===a(b,c)}function g(a,b){for(let c=0;3>c;c++)h[3*b+c]+=a[c]||0}let h=new Int16Array(3*c.length),k=0;for(;k<c.length;k++){var l=c[k];if(-1!==l){h[3*k+2]=b.hmtx.aWidth[l];var m=b.GPOS;if(m){m=m.lookupList;for(var p=0;p<m.length;p++){var n=m[p];for(var y=0;y<n.tabs.length;y++){var z=n.tabs[y];if(1===n.ltype){if(-1!==d._lctf.coverageIndex(z.coverage,l)&&z.pos){g(z.pos,k);break}}else if(2===
n.ltype){var H=null,B=e();if(-1!==B){var L=d._lctf.coverageIndex(z.coverage,c[B]);if(-1!==L){if(1===z.fmt)for(z=z.pairsets[L],L=0;L<z.length;L++)z[L].gid2===l&&(H=z[L]);else 2===z.fmt&&(H=d.U._getGlyphClass(c[B],z.classDef1),L=d.U._getGlyphClass(l,z.classDef2),H=z.matrix[H][L]);if(H){H.val1&&g(H.val1,B);H.val2&&g(H.val2,k);break}}}}else if(4===n.ltype){if(L=d._lctf.coverageIndex(z.markCoverage,l),-1!==L&&(B=e(f),H=-1===B?-1:d._lctf.coverageIndex(z.baseCoverage,c[B]),-1!==H)){n=z.markArray[L];y=z.baseArray[H][n.markClass];
h[3*k]=y.x-n.x+h[3*B]-h[3*B+2];h[3*k+1]=y.y-n.y+h[3*B+1];break}}else if(6===n.ltype&&(H=d._lctf.coverageIndex(z.mark1Coverage,l),-1!==H&&(B=e(),-1!==B&&(L=c[B],3===a(b,L)&&(L=d._lctf.coverageIndex(z.mark2Coverage,L),-1!==L))))){n=z.mark1Array[H];y=z.mark2Array[L][n.markClass];h[3*k]=y.x-n.x+h[3*B]-h[3*B+2];h[3*k+1]=y.y-n.y+h[3*B+1];break}}}}else b.kern&&!b.cff&&(m=e(),-1!==m&&(p=b.kern.glyph1.indexOf(c[m]),-1!==p&&(l=b.kern.rval[p].glyph2.indexOf(l),-1!==l&&(h[3*m+2]+=b.kern.rval[p].vals[l]))))}}return h}
function a(a,b){return(a=a.GDEF&&a.GDEF.glyphClassDef)?d.U._getGlyphClass(b,a):0}function c(...a){for(let b=0;b<a.length;b++)if("number"===typeof a[b])return a[b]}function e(a){let e=Object.create(null),f=a["OS/2"],g=a.hhea,k=a.head.unitsPerEm,m=c(f&&f.sTypoAscender,g&&g.ascender,k),n={unitsPerEm:k,ascender:m,descender:c(f&&f.sTypoDescender,g&&g.descender,0),capHeight:c(f&&f.sCapHeight,m),xHeight:c(f&&f.sxHeight,m),lineGap:c(f&&f.sTypoLineGap,g&&g.lineGap),supportsCodePoint(b){return 0<d.U.codeToGlyph(a,
b)},forEachGlyph(c,f,g,k){let m=0;const t=1/n.unitsPerEm*f,p=l(a,c);let r=0;const q=b(a,p);p.forEach((b,l)=>{if(-1!==b){var n=e[b];if(!n){const {cmds:c,crds:f}=d.U.glyphToPath(a,b);n="";var p=0;for(let a=0,b=c.length;a<b;a++){var v=h[c[a]];n+=c[a];for(var w=1;w<=v;w++)n+=(1<w?",":"")+f[p++]}let g;if(f.length){p=v=Infinity;w=g=-Infinity;for(let a=0,b=f.length;a<b;a+=2){let b=f[a],c=f[a+1];b<p&&(p=b);c<v&&(v=c);b>w&&(w=b);c>g&&(g=c)}}else p=w=v=g=0;n=e[b]={index:b,advanceWidth:a.hmtx.aWidth[b],xMin:p,
yMin:v,xMax:w,yMax:g,path:n}}k.call(null,n,m+q[3*l]*t,q[3*l+1]*t,r);m+=q[3*l+2]*t;g&&(m+=g*f)}r+=65535<c.codePointAt(r)?2:1});return m}};return n}let h={M:2,L:2,Q:4,C:6,Z:0},g={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",
L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},
n,m=[null,"isol","init","fina","medi"];return function(a){var b=new Uint8Array(a,0,4);b=d._bin.readASCII(b,0,4);if("wOFF"===b)a=f(a);else if("wOF2"===b)throw Error("woff2 fonts not supported");return e(d.parse(a)[0])}}],init(d,f,k){d=d();f=f();return k(d,f)}});R=ba.defineWorkerModule({name:"FontResolver",dependencies:[function(d,f){function k(a,b){let c=b=>{console.error(`Failure loading font ${a}`,b)};try{let e=new XMLHttpRequest;e.open("get",a,!0);e.responseType="arraybuffer";e.onload=function(){if(400<=
e.status)c(Error(e.statusText));else if(0<e.status)try{let c=d(e.response);c.src=a;b(c)}catch(n){c(n)}};e.onerror=c;e.send()}catch(g){c(g)}}function l(c,e){let d=b[c];d?e(d):a[c]?a[c].push(e):(a[c]=[e],k(c,e=>{e.src=c;b[c]=e;a[c].forEach(a=>a(e));delete a[c]}))}let b=Object.create(null),a=Object.create(null);return function(a,e,{lang:d,fonts:g=[],style:k="normal",weight:m="normal",unicodeFontsURL:p}={}){function c(){if(w.length){let b=w.map(b=>a.substring(b[0],b[1]+1)).join("\n");f.getFontsForString(b,
{lang:d||void 0,style:k,weight:m,dataUrl:p}).then(({fontUrls:a,chars:b})=>{let c=t.length,e=0;w.forEach(a=>{for(let d=0,f=a[1]-a[0];d<=f;d++)q[a[0]+d]=b[e++]+c;e++});let d=0;a.forEach((b,e)=>{l(b,b=>{t[e+c]=b;++d===a.length&&h()})})})}else h()}function h(){e({chars:q,fonts:t})}function n(a,b){for(let c=0;c<b.length;c++){let [e,d=e]=b[c];if(e<=a&&a<=d)return!0}return!1}let q=new Uint8Array(a.length),t=[];a.length||h();let v=new Map,w=[];"italic"!==k&&(k="normal");"number"!==typeof m&&(m="bold"===m?
700:400);g&&!Array.isArray(g)&&(g=[g]);g=g.slice().filter(a=>!a.lang||a.lang.test(d)).reverse();if(g.length){let e=0;(function C(d=0){for(let c=d,f=a.length;c<f;c++){d=a.codePointAt(c);if(1===e&&t[q[c-1]].supportsCodePoint(d)||/\s/.test(a[c]))q[c]=q[c-1],2===e&&(w[w.length-1][1]=c);else for(let a=q[c],f=g.length;a<=f;a++)if(a===f)(2===e?w[w.length-1]:w[w.length]=[c,c])[1]=c,e=2;else{q[c]=a;let {src:f,unicodeRange:h}=g[a];if(!h||n(d,h)){let a=b[f];if(!a){l(f,()=>{C(c)});return}if(a.supportsCodePoint(d)){let b=
v.get(a);"number"!==typeof b&&(b=t.length,t.push(a),v.set(a,b));q[c]=b;e=1;break}}}65535<d&&c+1<f&&(q[c+1]=q[c],c++,2===e&&(w[w.length-1][1]=c))}c()})()}else w.push([0,a.length-1]),c()}},R,function(){return function(d){function f(a){var b=(a&m).toString(16),c=((a&m)+g-1).toString(16);return"codepoint-index/plane"+(a>>16)+"/"+b+"-"+c+".json"}function k(a,b){a&=n;return 0!=((b.codePointAt(a/6|0)||48)-48&1<<a%6)}function l(a,b){a.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(a){return a.split("-").map(function(a){return parseInt(a.trim(),
16)})}).forEach(function(a){var c=a[0];a=a[1];void 0===a&&(a=c);b(c,a)})}function b(a,b){l(a,function(a,c){for(;a<=c;a++)b(a)})}function a(a){var c=x.get(a);return c||(c=new h,b(a.ranges,function(a){return c.add(a)}),x.set(a,c)),c}function c(a,b,c){if(a[b])a=b;else if(a[c])a=c;else a:{for(var e in a){a=e;break a}a=void 0}return a}function e(a){return r||(r=new Set,b("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(a){r.add(a)})),r.has(a)}var h=function(){this.buckets=new Map};h.prototype.add=
function(a){var b=a>>5;this.buckets.set(b,(this.buckets.get(b)||0)|1<<(31&a))};h.prototype.has=function(a){var b=this.buckets.get(a>>5);return void 0!==b&&0!=(b&1<<(31&a))};h.prototype.serialize=function(){var a=[];return this.buckets.forEach(function(b,c){a.push((+c).toString(36)+":"+b.toString(36))}),a.join(",")};h.prototype.deserialize=function(a){var b=this;this.buckets.clear();a.split(",").forEach(function(a){a=a.split(":");b.buckets.set(parseInt(a[0],36),parseInt(a[1],36))})};var g=Math.pow(2,
8),n=g-1,m=~n,p={},y={},x=new WeakMap,r,q=new Map;return d.CodePointSet=h,d.clearCache=function(){p={};y={}},d.getFontsForString=function(b,d){function g(a){var b=q.get(a);return b||(b=fetch(r+"/"+a).then(function(a){if(!a.ok)throw Error(a.statusText);return a.json().then(function(a){if(!Array.isArray(a)||1!==a[0])throw Error("Incorrect schema version; need 1, got "+a[0]);return a[1]})}).catch(function(b){if("https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data"!==r)return F||
(console.error('unicode-font-resolver: Failed loading from dataUrl "'+r+'", trying default CDN. '+b.message),F=!0),r="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data",q.delete(a),g(a);throw b;}),q.set(a,b)),b}void 0===d&&(d={});var h=d.lang;void 0===h&&(h=/\p{Script=Hangul}/u.test(b)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(b)?"ja":"en");var l=d.category;void 0===l&&(l="sans-serif");var m=d.style;void 0===m&&(m="normal");var n=d.weight;void 0===n&&(n=400);
var r=(d.dataUrl||"https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data").replace(/\/$/g,""),t=new Map,v=new Uint8Array(b.length),x={},A={},E=Array(b.length),K=new Map,F=!1;d=function(a){var c=b.codePointAt(a),e=f(c);E[a]=e;p[e]||K.has(e)||K.set(e,g(e).then(function(a){p[e]=a}));65535<c&&(a++,I=a)};for(var I=0;I<b.length;I++)d(I);return Promise.all(K.values()).then(function(){K.clear();for(var a=function(a){var e=b.codePointAt(a),d=null,f=p[E[a]],l=void 0,m;for(m in f){var n=
A[m];if(void 0===n&&(n=A[m]=(new RegExp(m)).test(h||"en")),n){for(var r in l=m,f[m])if(k(e,f[m][r])){d=r;break}break}}if(!d){var t;a:for(t in f)if(t!==l)for(var q in f[t])if(k(e,f[t][q])){d=q;break a}}d||(console.debug("No font coverage for U+"+e.toString(16)),d="latin");E[a]=d;y[d]||K.has(d)||K.set(d,g("font-meta/"+d+".json").then(function(a){y[d]=a}));65535<e&&(a++,c=a)},c=0;c<b.length;c++)a(c);return Promise.all(K.values())}).then(function(){for(var d,f=null,g=0;g<b.length;g++){var h=b.codePointAt(g);
if(f&&(e(h)||a(f).has(h)))v[g]=v[g-1];else{f=y[E[g]];var k=x[f.id];if(!k){var p=f.typeforms;k=c(p,l,"sans-serif");var q=c(p[k],m,"normal");p=null===(d=p[k])||void 0===d?void 0:d[q];var w=n,u=w;if(!p.includes(u)){u=1/0;for(var A=0;A<p.length;A++)Math.abs(p[A]-w)<Math.abs(u-w)&&(u=p[A])}k=x[f.id]=r+"/font-files/"+f.id+"/"+k+"."+q+"."+u+".woff"}q=t.get(k);null==q&&(q=t.size,t.set(k,q));v[g]=q}65535<h&&(g++,v[g]=v[g-1])}return{fontUrls:Array.from(t.keys()),chars:v}})},Object.defineProperty(d,"__esModule",
{value:!0}),d}({})}],init(d,f,k){return d(f,k())}});let S=()=>(self.performance||Date).now(),ka=Da["default"](),za,ja=[],qa=0,Va=(...d)=>new Promise((f,k)=>{ja.push(()=>{const l=S();try{ka.webgl.generateIntoCanvas(...d),f({timing:S()-l})}catch(b){k(b)}});qa||(qa=setTimeout(Ba,0))}),Ca={},Wa=0,$a=ka.webglUtils.resizeWebGLCanvasWithoutClearing,T={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:.0625,sdfExponent:9,textureWidth:2048},Xa=new E.Color,Ea=!1,la=Object.create(null),ma;Y=
ba.defineWorkerModule({name:"Typesetter",dependencies:[function(d,f){function k({text:a,lang:b,fonts:c,style:e,weight:f,preResolvedFonts:g,unicodeFontsURL:h},k){let l=({chars:a,fonts:b})=>{let c,e;const d=[];for(let f=0;f<a.length;f++)a[f]!==e?(e=a[f],d.push(c={start:f,end:f,fontObj:b[a[f]]})):c.end=f;k(d)};g?l(g):d(a,l,{lang:b,fonts:c,style:e,weight:f,unicodeFontsURL:h})}function l({text:d="",font:l,lang:n,fontSize:x=400,fontWeight:r=1,fontStyle:q="normal",letterSpacing:t=0,lineHeight:v="normal",
maxWidth:w=Infinity,direction:u,textAlign:E="left",textIndent:I=0,whiteSpace:C="normal",overflowWrap:z="normal",anchorX:H=0,anchorY:B=0,metricsOnly:L=!1,unicodeFontsURL:A,preResolvedFonts:M=null,includeCaretPositions:K=!1,chunkedBoundsSize:F=8192,colorRanges:S=null},O){let m=c(),p={fontLoad:0,typesetting:0};-1<d.indexOf("\r")&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),d=d.replace(/\r\n/g,"\n").replace(/\r/g,"\n"));x=+x;t=+t;w=+w;v=v||"normal";I=+I;k({text:d,lang:n,style:q,
weight:r,fonts:"string"===typeof l?[{src:l}]:l,unicodeFontsURL:A,preResolvedFonts:M},k=>{p.fontLoad=c()-m;let l=isFinite(w),n=null,r=null,q=null,y=null,A=null,G=null,J=null,M=null,N=0,P=0,V="nowrap"!==C,T=new Map,ba=c(),R=I,Y=0,U=new e,X=[U];k.forEach(a=>{let {fontObj:b}=a,{ascender:c,descender:f,unitsPerEm:k,lineGap:m,capHeight:n,xHeight:p}=b,r=T.get(b);if(!r){var q=x/k;let a="normal"===v?(c-f+m)*q:v*x,e=Math.min(a,(c-f)*q),d=(c+f)/2*q+e/2;r={index:T.size,src:b.src,fontObj:b,fontSizeMult:q,unitsPerEm:k,
ascender:c*q,descender:f*q,capHeight:n*q,xHeight:p*q,lineHeight:a,baseline:-((a-(c-f)*q)/2)-c*q,caretTop:d,caretBottom:d-e};T.set(b,r)}let {fontSizeMult:y}=r;q=d.slice(a.start,a.end+1);let u,A;b.forEachGlyph(q,x,t,(b,c,f,k)=>{c+=Y;k+=a.start;u=c;A=b;let m=d.charAt(k),n=b.advanceWidth*y;var p=U.count;"isEmpty"in b||(b.isWhitespace=!!m&&/[^\S\u00A0]/.test(m),b.canBreakAfter=!!m&&g.test(m),b.isEmpty=b.xMin===b.xMax||b.yMin===b.yMax||h.test(m));b.isWhitespace||b.isEmpty||P++;if(V&&l&&!b.isWhitespace&&
c+n+R>w&&p){if(U.glyphAt(p-1).glyphObj.canBreakAfter){var q=new e;R=-c}else for(;p--;)if(0===p&&"break-word"===z){q=new e;R=-c;break}else if(U.glyphAt(p).glyphObj.canBreakAfter){q=U.splitAt(p+1);p=q.glyphAt(0).x;R-=p;for(let a=q.count;a--;)q.glyphAt(a).x-=p;break}q&&(U.isSoftWrapped=!0,U=q,X.push(U),N=w)}q=U.glyphAt(U.count);q.glyphObj=b;q.x=c+R;q.y=f;q.width=n;q.charIndex=k;q.fontData=r;"\n"===m&&(U=new e,X.push(U),R=-(c+n+t*x)+I)});Y=u+A.advanceWidth*y+t*x});let ca=0;X.forEach(a=>{let b=!0;for(let e=
a.count;e--;){var c=a.glyphAt(e);b&&!c.glyphObj.isWhitespace&&(a.width=c.x+c.width,a.width>N&&(N=a.width),b=!1);let {lineHeight:d,capHeight:f,xHeight:g,baseline:h}=c.fontData;d>a.lineHeight&&(a.lineHeight=d);c=h-a.baseline;0>c&&(a.baseline+=c,a.cap+=c,a.ex+=c);a.cap=Math.max(a.cap,a.baseline+f);a.ex=Math.max(a.ex,a.baseline+g)}a.baseline-=ca;a.cap-=ca;a.ex-=ca;ca+=a.lineHeight});let ea=0,da=0;H&&("number"===typeof H?ea=-H:"string"===typeof H&&(ea=-N*("left"===H?0:"center"===H?.5:"right"===H?1:b(H))));
B&&("number"===typeof B?da=-B:"string"===typeof B&&(da="top"===B?0:"top-baseline"===B?-X[0].baseline:"top-cap"===B?-X[0].cap:"top-ex"===B?-X[0].ex:"middle"===B?ca/2:"bottom"===B?ca:"bottom-baseline"===B?-X[X.length-1].baseline:b(B)*ca));if(!L){let b=f.getEmbeddingLevels(d,u);n=new Uint16Array(P);r=new Uint8Array(P);q=new Float32Array(2*P);y={};J=[Infinity,Infinity,-Infinity,-Infinity];M=[];K&&(G=new Float32Array(4*d.length));S&&(A=new Uint8Array(3*P));let c=0,e=-1,g=-1,h,l;X.forEach((k,m)=>{let {count:p,
width:t}=k;if(0<p){m=0;for(var w=p;w--&&k.glyphAt(w).glyphObj.isWhitespace;)m++;var v=w=0;if("center"===E)w=(N-t)/2;else if("right"===E)w=N-t;else if("justify"===E&&k.isSoftWrapped){v=0;for(var u=p-m;u--;)k.glyphAt(u).glyphObj.isWhitespace&&v++;v=(N-t)/v}if(v||w){u=0;for(var x=0;x<p;x++){var z=k.glyphAt(x),B=z.glyphObj;z.x+=w+u;0!==v&&B.isWhitespace&&x<p-m&&(u+=v,z.width+=v)}}w=f.getReorderSegments(d,b,k.glyphAt(0).charIndex,k.glyphAt(k.count-1).charIndex);for(v=0;v<w.length;v++){let [a,b]=w[v];u=
Infinity;x=-Infinity;for(z=0;z<p;z++)if(k.glyphAt(z).charIndex>=a){for(B=z;z<p;z++){var C=k.glyphAt(z);if(C.charIndex>b)break;z<p-m&&(u=Math.min(u,C.x),x=Math.max(x,C.x+C.width))}for(;B<z;B++)C=k.glyphAt(B),C.x=x-(C.x+C.width-u);break}}let D;m=a=>D=a;for(w=0;w<p;w++){u=k.glyphAt(w);D=u.glyphObj;v=D.index;(x=b.levels[u.charIndex]&1)&&(z=f.getMirroredCharacter(d[u.charIndex]))&&u.fontData.fontObj.forEachGlyph(z,0,0,m);if(K){let {charIndex:b,fontData:c}=u;z=u.x+ea;B=u.x+u.width+ea;G[4*b]=x?B:z;G[4*b+
1]=x?z:B;G[4*b+2]=k.baseline+c.caretBottom+da;G[4*b+3]=k.baseline+c.caretTop+da;x=b-e;1<x&&a(G,e,x);e=b}if(S)for({charIndex:x}=u;x>g;)g++,S.hasOwnProperty(g)&&(l=S[g]);if(!D.isWhitespace&&!D.isEmpty){x=c++;let {fontSizeMult:a,src:b,index:e}=u.fontData;z=y[b]||(y[b]={});z[v]||(z[v]={path:D.path,pathBounds:[D.xMin,D.yMin,D.xMax,D.yMax]});B=u.x+ea;C=u.y+k.baseline+da;q[2*x]=B;q[2*x+1]=C;u=B+D.xMin*a;z=C+D.yMin*a;B+=D.xMax*a;C+=D.yMax*a;u<J[0]&&(J[0]=u);z<J[1]&&(J[1]=z);B>J[2]&&(J[2]=B);C>J[3]&&(J[3]=
C);0===x%F&&(h={start:x,end:x,rect:[Infinity,Infinity,-Infinity,-Infinity]},M.push(h));h.end++;let d=h.rect;u<d[0]&&(d[0]=u);z<d[1]&&(d[1]=z);B>d[2]&&(d[2]=B);C>d[3]&&(d[3]=C);n[x]=v;r[x]=e;S&&(v=3*x,A[v]=l>>16&255,A[v+1]=l>>8&255,A[v+2]=l&255)}}}});G&&(k=d.length-e,1<k&&a(G,e,k))}let Z=[];T.forEach(({index:a,src:b,unitsPerEm:c,ascender:e,descender:d,lineHeight:f,capHeight:g,xHeight:h})=>{Z[a]={src:b,unitsPerEm:c,ascender:e,descender:d,lineHeight:f,capHeight:g,xHeight:h}});p.typesetting=c()-ba;O({glyphIds:n,
glyphFontIndices:r,glyphPositions:q,glyphData:y,fontData:Z,caretPositions:G,glyphColors:A,chunkedBounds:M,fontSize:x,topBaseline:da+X[0].baseline,blockBounds:[ea,da-ca,ea+N,da],visibleBounds:J,timings:p})})}function b(a){a=(a=a.match(/^([\d.]+)%$/))?parseFloat(a[1]):NaN;return isNaN(a)?0:a/100}function a(a,b,c){let e=a[4*b],d=a[4*b+2],f=a[4*b+3],g=(a[4*b+1]-e)/c;for(let h=0;h<c;h++){let c=4*(b+h);a[c]=e+g*h;a[c+1]=e+g*(h+1);a[c+2]=d;a[c+3]=f}}function c(){return(self.performance||Date).now()}function e(){this.data=
[]}let h=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,g=/[^\S\u00A0]|[\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/,n="glyphObj x y width charIndex fontData".split(" ");e.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/n.length)},glyphAt(a){let b=e.flyweight;b.data=this.data;b.index=a;return b},splitAt(a){let b=new e;
b.data=this.data.splice(a*n.length);return b}};e.flyweight=n.reduce((a,b,c,e)=>{Object.defineProperty(a,b,{get(){return this.data[this.index*n.length+c]},set(a){this.data[this.index*n.length+c]=a}});return a},{data:null,index:0});return{typeset:l,measure:function(a,b){l({...a,metricsOnly:!0},a=>{let [c,e,d,f]=a.blockBounds;b({width:d-c,height:f-e})})}}},R,Y["default"]],init(d,f,k){return d(f,k())}});let Za=ba.defineWorkerModule({name:"Typesetter",dependencies:[Y],init(d){return function(f){return new Promise(k=>
{d.typeset(f,k)})}},getTransferables(d){const f=[];for(let k in d)d[k]&&d[k].buffer&&f.push(d[k].buffer);return f}}),Ja={};class Ma extends E.InstancedBufferGeometry{constructor(){super();this.detail=1;this.curveRadius=0;this.groups=[{start:0,count:Infinity,materialIndex:0},{start:0,count:Infinity,materialIndex:1}];this.boundingSphere=new E.Sphere;this.boundingBox=new E.Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(d){if(d!==this._detail){this._detail=d;if("number"!==typeof d||1>
d)d=1;let f=ab(d);["position","normal","uv"].forEach(d=>{this.attributes[d]=f.attributes[d].clone()});this.setIndex(f.getIndex().clone())}}get detail(){return this._detail}set curveRadius(d){d!==this._curveRadius&&(this._curveRadius=d,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(d,f,k,l,b){this.updateAttributeData("aTroikaGlyphBounds",d,4);this.updateAttributeData("aTroikaGlyphIndex",f,1);this.updateAttributeData("aTroikaGlyphColor",b,3);this._blockBounds=k;this._chunkedBounds=
l;this.instanceCount=f.length;this._updateBounds()}_updateBounds(){let d=this._blockBounds;if(d){let {curveRadius:l,boundingBox:b}=this;if(l){let {PI:a,floor:c,min:e,max:h,sin:g,cos:n}=Math;var f=a/2,k=2*a;let m=Math.abs(l),p=d[0]/m,y=d[2]/m,x=c((p+f)/k)!==c((y+f)/k)?-m:e(g(p)*m,g(y)*m);f=c((p-f)/k)!==c((y-f)/k)?m:h(g(p)*m,g(y)*m);k=c((p+a)/k)!==c((y+a)/k)?2*m:h(m-n(p)*m,m-n(y)*m);b.min.set(x,d[1],0>l?-k:0);b.max.set(f,d[3],0>l?0:k)}else b.min.set(d[0],d[1],0),b.max.set(d[2],d[3],0);b.getBoundingSphere(this.boundingSphere)}}applyClipRect(d){let f=
this.getAttribute("aTroikaGlyphIndex").count,k=this._chunkedBounds;if(k)for(let l=k.length;l--;){f=k[l].end;let b=k[l].rect;if(b[1]<d.w&&b[3]>d.y&&b[0]<d.z&&b[2]>d.x)break}this.instanceCount=f}updateAttributeData(d,f,k){let l=this.getAttribute(d);f?l&&l.array.length===f.length?(l.array.set(f),l.needsUpdate=!0):(this.setAttribute(d,new E.InstancedBufferAttribute(f,k)),delete this._maxInstanceCount,this.dispose()):l&&this.deleteAttribute(d)}}let wa=new E.MeshBasicMaterial({color:16777215,side:E.DoubleSide,
transparent:!0}),Na=new E.Matrix4,na=new E.Vector3,xa=new E.Vector3,ia=[],db=new E.Vector3,Oa=()=>{let d=new E.Mesh(new E.PlaneGeometry(1,1),wa);Oa=()=>d;return d},Pa=()=>{let d=new E.Mesh(new E.PlaneGeometry(1,1,32,1),wa);Pa=()=>d;return d},eb={type:"syncstart"},fb={type:"synccomplete"},Qa="font fontSize fontStyle fontWeight lang letterSpacing lineHeight maxWidth overflowWrap text direction textAlign textIndent whiteSpace anchorX anchorY colorRanges sdfGlyphSize".split(" "),gb=Qa.concat("material",
"color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class oa extends E.Mesh{constructor(){super(new Ma,null);this.text="";this.curveRadius=this.anchorY=this.anchorX=0;this.direction="auto";this.unicodeFontsURL=this.font=null;this.fontSize=.1;this.fontStyle=this.fontWeight="normal";this.lang=null;this.letterSpacing=0;this.lineHeight="normal";this.maxWidth=Infinity;this.overflowWrap="normal";this.textAlign="left";this.textIndent=0;this.whiteSpace="normal";this.colorRanges=
this.color=this.material=null;this.outlineColor=this.outlineWidth=0;this.outlineOpacity=1;this.strokeWidth=this.outlineOffsetY=this.outlineOffsetX=this.outlineBlur=0;this.strokeColor=8421504;this.fillOpacity=this.strokeOpacity=1;this.depthOffset=0;this.clipRect=null;this.orientation="+x+y";this.glyphGeometryDetail=1;this.sdfGlyphSize=null;this.gpuAccelerateSDF=!0;this.debugSDF=!1}sync(d){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(d):(this._isSyncing=
!0,this.dispatchEvent(eb),ra({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,
sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},f=>{this._isSyncing=!1;this._textRenderInfo=f;this.geometry.updateGlyphs(f.glyphBounds,f.glyphAtlasIndices,f.blockBounds,f.chunkedBounds,f.glyphColors);let k=this._queuedSyncs;k&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{k.forEach(d=>d&&d())}));this.dispatchEvent(fb);d&&d()})))}onBeforeRender(d,f,k,l,b,a){this.sync();b.isTroikaTextMaterial&&this._prepareForRender(b)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||
null}createDerivedMaterial(d){return sa(d)}get material(){let d=this._derivedMaterial,f=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=wa.clone());d&&d.isDerivedFrom(f)||(d=this._derivedMaterial=this.createDerivedMaterial(f),f.addEventListener("dispose",function l(){f.removeEventListener("dispose",l);d.dispose()}));if(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let f=d._outlineMtl;f||(f=d._outlineMtl=Object.create(d,{id:{value:d.id+.1}}),f.isTextOutlineMaterial=
!0,f.depthWrite=!1,f.map=null,d.addEventListener("dispose",function b(){d.removeEventListener("dispose",b);f.dispose()}));return[f,d]}return d}set material(d){d&&d.isTroikaTextMaterial?(this._derivedMaterial=d,this._baseMaterial=d.baseMaterial):this._baseMaterial=d}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(d){this.geometry.detail=d}get curveRadius(){return this.geometry.curveRadius}set curveRadius(d){this.geometry.curveRadius=d}get customDepthMaterial(){return Ka(this.material).getDepthMaterial()}get customDistanceMaterial(){return Ka(this.material).getDistanceMaterial()}_prepareForRender(d){var f=
d.isTextOutlineMaterial,k=d.uniforms,l=this.textRenderInfo;if(l){let {sdfTexture:a,blockBounds:c}=l;k.uTroikaSDFTexture.value=a;k.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height);k.uTroikaSDFGlyphSize.value=l.sdfGlyphSize;k.uTroikaSDFExponent.value=l.sdfExponent;k.uTroikaTotalBounds.value.fromArray(c);k.uTroikaUseGlyphColors.value=!f&&!!l.glyphColors;let e=l=0,d=0,g;let n=0,m=0;if(f){let {outlineWidth:a,outlineOffsetX:b,outlineOffsetY:c,outlineBlur:d,outlineOpacity:f}=this;l=this._parsePercent(a)||
0;e=Math.max(0,this._parsePercent(d)||0);g=f;n=this._parsePercent(b)||0;m=this._parsePercent(c)||0}else{if(d=Math.max(0,this._parsePercent(this.strokeWidth)||0)){var b=this.strokeColor;k.uTroikaStrokeColor.value.set(null==b?8421504:b);b=this.strokeOpacity;null==b&&(b=1)}g=this.fillOpacity}k.uTroikaDistanceOffset.value=l;k.uTroikaPositionOffset.value.set(n,m);k.uTroikaBlurRadius.value=e;k.uTroikaStrokeWidth.value=d;k.uTroikaStrokeOpacity.value=b;k.uTroikaFillOpacity.value=null==g?1:g;k.uTroikaCurveRadius.value=
this.curveRadius||0;(l=this.clipRect)&&Array.isArray(l)&&4===l.length?k.uTroikaClipRect.value.fromArray(l):(l=100*(this.fontSize||.1),k.uTroikaClipRect.value.set(c[0]-l,c[1]-l,c[2]+l,c[3]+l));this.geometry.applyClipRect(k.uTroikaClipRect.value)}k.uTroikaSDFDebug.value=!!this.debugSDF;d.polygonOffset=!!this.depthOffset;d.polygonOffsetFactor=d.polygonOffsetUnits=this.depthOffset||0;f=f?this.outlineColor||0:this.color;null==f?delete d.color:(l=d.hasOwnProperty("color")?d.color:d.color=new E.Color,(f!==
l._input||"object"===typeof f)&&l.set(l._input=f));f=this.orientation||"+x+y";if(f!==d._orientation){k=k.uTroikaOrient.value;f=f.replace(/[^-+xyz]/g,"");if(l="+x+y"!==f&&f.match(/^([-+])([xyz])([-+])([xyz])$/)){let [,a,b,e,d]=l;na.set(0,0,0)[b]="-"===a?1:-1;xa.set(0,0,0)[d]="-"===e?-1:1;Na.lookAt(db,na.cross(xa),xa);k.setFromMatrix4(Na)}else k.identity();d._orientation=f}}_parsePercent(d){"string"===typeof d&&(d=(d=d.match(/^(-?[\d.]+)%$/))?parseFloat(d[1]):NaN,d=(isNaN(d)?0:d/100)*this.fontSize);
return d}localPositionToTextCoords(d,f=new E.Vector2){f.copy(d);let k=this.curveRadius;k&&(f.x=Math.atan2(d.x,Math.abs(k)-Math.abs(d.z))*Math.abs(k));return f}worldPositionToTextCoords(d,f=new E.Vector2){na.copy(d);return this.localPositionToTextCoords(this.worldToLocal(na),f)}raycast(d,f){let {textRenderInfo:k,curveRadius:l}=this;if(k){let b=k.blockBounds,a=l?Pa():Oa(),c=a.geometry,{position:e,uv:h}=c.attributes;for(let a=0;a<h.count;a++){let c=b[0]+h.getX(a)*(b[2]-b[0]),d=b[1]+h.getY(a)*(b[3]-b[1]),
f=0;l&&(f=l-Math.cos(c/l)*l,c=Math.sin(c/l)*l);e.setXYZ(a,c,d,f)}c.boundingSphere=this.geometry.boundingSphere;c.boundingBox=this.geometry.boundingBox;a.matrixWorld=this.matrixWorld;a.material.side=this.material.side;ia.length=0;a.raycast(d,ia);for(d=0;d<ia.length;d++)ia[d].object=this,f.push(ia[d])}}copy(d){let f=this.geometry;super.copy(d);this.geometry=f;gb.forEach(f=>{this[f]=d[f]});return this}clone(){return(new this.constructor).copy(this)}}Qa.forEach(d=>{let f="_private_"+d;Object.defineProperty(oa.prototype,
d,{get(){return this[f]},set(d){d!==this[f]&&(this[f]=d,this._needsSync=!0)}})});let hb={type:"syncstart"},ib={type:"synccomplete"},ha=17;ha=4*Math.ceil(ha/4);let Ra=new E.Box3,jb=new E.Color;class Sa extends oa{constructor(){super();this._texts=new Map;this._onInstanceSynced=d=>{this._texts.get(d.target).dirty=!0};this._onInstanceRemoved=d=>{this.removeText(d.target)}}add(...d){for(let f=0;f<d.length;f++)d[f]instanceof oa?this.addText(d[f]):super.add(d[f]);return this}addText(d){this._texts.has(d)||
(this._texts.set(d,{index:-1,glyphCount:-1,dirty:!0}),d.addEventListener("removed",this._onInstanceRemoved),d.addEventListener("synccomplete",this._onInstanceSynced))}removeText(d){d.removeEventListener("removed",this._onInstanceRemoved);d.removeEventListener("synccomplete",this._onInstanceSynced);this._texts.delete(d)}createDerivedMaterial(d){return bb(d)}updateMatrixWorld(d){super.updateMatrixWorld(d);this.updateBounds()}updateBounds(){let d=this.geometry.boundingBox.makeEmpty();this._texts.forEach((f,
k)=>{k.matrixAutoUpdate&&k.updateMatrix();Ra.copy(k.geometry.boundingBox).applyMatrix4(k.matrix);d.union(Ra)});d.getBoundingSphere(this.geometry.boundingSphere)}_prepareForRender(d){let f=this._mat4Texture,k=Math.pow(2,Math.ceil(Math.log2(this._texts.size*ha)));if(!f||k!==f.image.data.length){f&&f.dispose();let b=Math.min(k/4,1024);f=this._mat4Texture=new E.DataTexture(new Float32Array(k),b,k/4/b,E.RGBAFormat,E.FloatType)}let l=f.image.data;this._texts.forEach(({index:b},a)=>{if(-1<b){b*=ha;let d=
a.matrix.elements;for(let a=0;16>a;a++){var c=b+a,e=d[a];e!==l[c]&&(l[c]=e,f.needsUpdate=!0)}c=a.color;null==c&&(c=this.color);null==c&&(c=this.material.color);null==c&&(c=16777215);a=b+16;b=jb.set(c).getHex();b!==l[a]&&(l[a]=b,f.needsUpdate=!0)}});d.setMatrixTexture(f);super._prepareForRender(d)}sync(d){let f;this._texts.forEach((d,l)=>{if(d.dirty||l._needsSync)d.dirty=!1,(f||(f=[])).push(new Promise(b=>{l._needsSync?l.sync(b):b()}))});f&&(this.dispatchEvent(hb),Promise.all(f).then(()=>{let {geometry:f}=
this,l=f.attributes,b=l.aTroikaTextInstanceIndex&&l.aTroikaTextInstanceIndex.array||new Uint8Array(0),a=l.aTroikaGlyphIndex&&l.aTroikaGlyphIndex.array||new Float32Array(0),c=l.aTroikaGlyphBounds&&l.aTroikaGlyphBounds.array||new Float32Array(0),e=0;this._texts.forEach((a,{textRenderInfo:b})=>{b&&(e+=b.glyphAtlasIndices.length,this._textRenderInfo=b)});e!==b.length&&(b=ta(b,e),a=ta(a,e),c=ta(c,4*e));let h=0,g=0;this._texts.forEach((d,{textRenderInfo:e})=>{if(e){let f=e.glyphAtlasIndices.length;b.fill(h,
g,g+f);a.set(e.glyphAtlasIndices,g,g+f);c.set(e.glyphBounds,4*g,4*(g+f));g+=f;d.index=h++}});f.updateAttributeData("aTroikaTextInstanceIndex",b,1);f.updateAttributeData("aTroikaGlyphIndex",a,1);f.updateAttributeData("aTroikaGlyphBounds",c,4);this.updateBounds();this.dispatchEvent(ib);d&&d()}))}copy(d){d instanceof Sa&&(super.copy(d),this._texts.forEach((d,k)=>this.removeText(k)),d._texts.forEach((d,k)=>this.addText(k)));return this}dispose(){super.dispose();this._mat4Texture.dispose()}}let Ta=new WeakMap,
La=new WeakMap;I.BatchedText=Sa;I.GlyphsGeometry=Ma;I.Text=oa;I.configureTextBuilder=function(d){Ea?console.warn("configureTextBuilder called after first font request; will be ignored."):Fa(T,d)};I.createTextDerivedMaterial=sa;I.dumpSDFTextures=function(){Object.keys(la).forEach(d=>{d=la[d].sdfCanvas;let {width:f,height:k}=d;console.log("%c.",`
      background: url(${d.toDataURL()});
      background-size: ${f}px ${k}px;
      color: transparent;
      font-size: 0;
      line-height: ${k}px;
      padding-left: ${f}px;
    `)})};I.fontResolverWorkerModule=R;I.getCaretAtPoint=function(d,f,k){let l=null,b=null;cb(d).forEach(a=>{if(!b||Math.abs(k-(a.top+a.bottom)/2)<Math.abs(k-(b.top+b.bottom)/2))b=a});b.carets.forEach(a=>{if(!l||Math.abs(f-a.x)<Math.abs(f-l.x))l=a});return l};I.getSelectionRects=function(d,f,k){var l;if(d){if((l=Ta.get(d))&&l.start===f&&l.end===k)return l.rects;var {caretPositions:b}=d;k<f&&(l=f,f=k,k=l);f=Math.max(f,0);k=Math.min(k,b.length+1);l=[];var a=null;for(var c=f;c<k;c++){var e=b[4*c],h=
b[4*c+1];let d=Math.min(e,h);e=Math.max(e,h);h=b[4*c+2];let f=b[4*c+3];if(!a||h!==a.bottom||f!==a.top||d>a.right||e<a.left)a={left:Infinity,right:-Infinity,bottom:h,top:f},l.push(a);a.left=Math.min(d,a.left);a.right=Math.max(e,a.right)}l.sort((a,b)=>b.bottom-a.bottom||a.left-b.left);for(b=l.length-1;0<b--;)a=l[b],c=l[b+1],a.bottom===c.bottom&&a.top===c.top&&a.left<=c.right&&a.right>=c.left&&(c.left=Math.min(c.left,a.left),c.right=Math.max(c.right,a.right),l.splice(b,1));Ta.set(d,{start:f,end:k,rects:l})}return l};
I.getTextRenderInfo=ra;I.preloadFont=function({font:d,characters:f,sdfGlyphSize:k},l){f=Array.isArray(f)?f.join("\n"):""+f;ra({font:d,sdfGlyphSize:k,text:f},l)};I.typesetterWorkerModule=Y;Object.defineProperty(I,"__esModule",{value:!0})})
